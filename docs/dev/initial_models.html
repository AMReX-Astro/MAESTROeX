<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Initial Models &mdash; MAESTROeX  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=10589de1" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "macros": {"rhozero": "{\\rho_0}", "pizero": "{\\pi_0}", "pizeroone": "{\\pi_0^{(1)}}", "pizerotwo": "{\\pi_0^{(2)}}", "gammabar": "{\\overline{\\Gamma}_1}", "ptl": "{\\partial}", "eb": "{{\\bf e}}", "fb": "{{\\bf f}}", "ib": "{{\\bf i}}", "Ub": "{{\\bf U}}", "Vb": "{{\\bf V}}", "xb": "{{\\bf x}}", "ut": "{{\\tilde{u}}}", "vt": "{{\\tilde{v}}}", "wt": "{{\\tilde{w}}}", "Ubt": "{\\widetilde{\\Ub}}", "edge": "{{\\rm EDGE}}", "mac": "{{\\rm MAC}}", "trans": "{{\\rm TRANS}}", "nablab": "{\\mathbf{\\nabla}}", "cdotb": "{\\mathbf{\\cdot}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\frac{1}{2}}", "nph": "{{n + \\myhalf}}", "nmh": "{{n - \\myhalf}}", "Hext": "{{H_{\\rm ext}}}", "Hnuc": "{{H_{\\rm nuc}}}", "kth": "{k_{\\rm th}}", "init": "{\\rm init}", "model": "{\\rm model}", "raw": "{\\rm raw}", "pred": "{{\\rm pred}}", "Sbar": "{\\overline{S}}", "inp": "{\\mathrm{in}}", "initp": "{\\mathrm{init}}", "outp": "{\\mathrm{out}}", "uadv": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvone": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV},\\star}}", "uadvonedag": "{\\Ubt^{\\mathrm{ADV},\\dagger,\\star}}", "uadvtwo": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvtwodag": "{\\Ubt^{\\mathrm{ADV},\\dagger}}", "uadvsdcstar": "{\\mathbf{U}^{\\mathrm{ADV},\\star}}", "uadvsdcpred": "{\\mathbf{U}^{\\mathrm{ADV},\\mathrm{pred}}}", "uadvsdc": "{\\mathbf{U}^{\\mathrm{ADV}}}", "dt": "{\\Delta t}", "dr": "{\\Delta r}", "etarho": "{\\eta_{\\rho}}", "etarhoec": "{\\etarho^{\\rm ec}}", "etarhocc": "{\\etarho^{\\rm cc}}", "etarhoflux": "{\\etarho^{\\rm flux}}", "divetarho": "{\\nabla\\cdot(\\etarho\\eb_r)}", "ow": "{\\overline{w}_0}", "dw": "{\\delta w_0}", "thalf": "{\\frac{3}{2}}", "rhop": "{{\\rho^{\\prime}}}", "omegadot": "{\\dot{\\omega}}", "er": "{\\mathbf{e}_r}", "ex": "{\\mathbf{e}_x}", "ey": "{\\mathbf{e}_y}", "ez": "{\\mathbf{e}_z}", "Omegab": "{{\\bf \\Omega}}", "rb": "{{\\bf r}}", "boxtype": "{{\\tt box\\/}}", "fab": "{{\\tt fab\\/}}", "multifab": "{{\\tt multifab\\/}}", "boxarray": "{{\\tt boxarray\\/}}", "mlboxarray": "{{\\tt ml\\_boxarray\\/}}", "layout": "{{\\tt layout\\/}}", "mllayout": "{{\\tt ml\\_layout\\/}}", "bctower": "{{\\tt bc\\_tower\\/}}", "bclevel": "{{\\tt bc\\_level\\/}}", "mgtower": "{{\\tt mg\\_tower\\/}}", "bndryreg": "{{\\tt bndry\\_reg\\/}}", "runparam": ["{\\index{Runtime parameters!{\\tt #1}}{\\tt #1}}", 1], "runparamidx": ["{\\index{Runtime parameters!{\\tt #1}}}", 1], "code": ["{\\index{Code reference!{\\tt #1}}{\\tt #1}}", 1], "codeidx": ["{\\index{Code reference!{\\tt #1}}}", 1], "otherindex": ["{\\index{#1!#2}}", 2], "fdamp": "{{f_\\mathrm{damp}}}"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GPU" href="gpu.html" />
    <link rel="prev" title="namespace: maestro" href="runtime_parameters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            MAESTROeX
              <img src="_static/maestroex_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="../initial_models.html">main</a> | <a href="./initial_models.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">MAESTROeX basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html">Governing Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html#numerical-methodology">Numerical Methodology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using MAESTROeX</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="addproblem.html">Adding A New Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="param_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Initial Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-model-data-from-raw-data">Creating the Model Data from Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-initial-data-from-the-model-data">Creating the Initial Data from the Model Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-base-state-and-full-state">Creating the Base State and Full State</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coarse-fine-enforce-hse-discretization">Coarse-Fine enforce_HSE Discretization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_state.html">Base State</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="makefiles.html">MAESTROeX Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="managingjobs.html">Managing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MAESTROeX technical details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lo_density.html">Low Density Cutoffs</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume_discrepancy.html">Volume Discrepancy Factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="eos_notes.html">Equation of State Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html">The Mixing Term, <span class="math notranslate nohighlight">\(\etarho\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#eta-flow-chart"><span class="math notranslate nohighlight">\(\eta\)</span> Flow Chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#computing-etarhoec-and-etarhocc">Computing <span class="math notranslate nohighlight">\(\etarhoec\)</span> and <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhoec">Using <span class="math notranslate nohighlight">\(\etarhoec\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhocc">Using <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="pert.html">Interface State Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="Godunov.html">Godunov Interface States</a></li>
<li class="toctree-l1"><a class="reference internal" href="mg.html">Multigrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation in MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="spherical_basestate.html">Modifications for a Spherical Self-Gravitating Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="planar_invsq_basestate.html">Modifications for a <span class="math notranslate nohighlight">\(1/r^2\)</span> Plane-Parallel Basestate</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermo_notes.html">Notes on Thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="beta0.html">Notes on <span class="math notranslate nohighlight">\(\beta_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="enthalpy.html">Notes on Enthalpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="regtest.html">Regression Testing and Continuous Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAESTROeX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Initial Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/initial_models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="initial-models">
<span id="sec-initial-models-main"></span><h1>Initial Models<a class="headerlink" href="#initial-models" title="Link to this heading"></a></h1>
<p>Here we briefly describe the various routines for generating initial models
for the main MAESTROeX problems and how the initial model is used to initialize
both the base state and the full Cartesian state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When run, MAESTROeX outputs info that’s useful to check, including <code class="docutils literal notranslate"><span class="pre">dr</span></code> of
base state and <code class="docutils literal notranslate"><span class="pre">dr</span></code> of the input file, which should be the same at the
finest level; and Maximum HSE Error, which should be some small number.</p>
</div>
<section id="creating-the-model-data-from-raw-data">
<span id="sec-creating-the-model-data-from-raw-data"></span><h2>Creating the Model Data from Raw Data<a class="headerlink" href="#creating-the-model-data-from-raw-data" title="Link to this heading"></a></h2>
<p>We have found that for the best performance, the MAESTROeX
initialization procedure should be given model data with the same
resolution as the base state resolution, <span class="math notranslate nohighlight">\(\Delta r\)</span>.</p>
<ul class="simple">
<li><p>For planar problems, <span class="math notranslate nohighlight">\(\Delta r = \Delta x\)</span>.</p></li>
<li><p>For multilevel planar problems, we use <span class="math notranslate nohighlight">\(\Delta r\)</span> equal to <span class="math notranslate nohighlight">\(\Delta x\)</span>
at the finest resolution.</p></li>
<li><p>For spherical problems we set <span class="math notranslate nohighlight">\(\Delta r = \Delta x/\mathtt{drdxfac}\)</span>.</p></li>
</ul>
<p>We generate our initial model either analytically or from raw data,
<span class="math notranslate nohighlight">\(\rho^{\raw}, T^{\raw}, p^{\raw}\)</span>, and <span class="math notranslate nohighlight">\(X^{\raw}\)</span>.</p>
<p>Here is the raw data file for each test
problem:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-0">
<span class="eqno">(95)<a class="headerlink" href="#equation-initial-models-0" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
{\tt reacting\_bubble} &amp; \rightarrow &amp; \mathrm{none-it~ is~ generated~ analytically} \nonumber \nonumber \\
{\tt test\_convect} &amp; \rightarrow &amp; \mathrm{none-it~ is~ generated~ analytically} \nonumber \nonumber \\
{\tt wdconvect} &amp; \rightarrow &amp; {\tt model\_6.e8.raw} \nonumber \\
{\tt spherical\_heat} &amp; \rightarrow &amp; \mathrm{none-it~ is~ generated~ analytically} \nonumber \\\end{aligned}\end{split}\]</div>
<p>We use a fortran subroutine
to interpolate the raw data, yielding the model data, <span class="math notranslate nohighlight">\(\rho^{\model},
T^{\model}, p^{\model}\)</span>, and <span class="math notranslate nohighlight">\(X^{\model}\)</span>. The fortran subroutine
then uses an iterative procedure to modify the model data so that it
is thermodynamically consistent with the MAESTROeX equation of
state (EOS), and also satisfies our chosen hydrostatic equilibrium
(HSE) discretization,</p>
<div class="math notranslate nohighlight" id="equation-eq-hse-discretization">
<span class="eqno">(96)<a class="headerlink" href="#equation-eq-hse-discretization" title="Link to this equation"></a></span>\[\frac{p_r - p_{r-1}}{\Delta r} = \frac{\rho_r + \rho_{r-1}}{2}g_{r-\myhalf},\]</div>
<p>to a user defined tolerance. The shared <code class="docutils literal notranslate"><span class="pre">initial_models</span></code> git repo
(<a class="reference external" href="https://github.com/AMReX-Astro/initial_models">https://github.com/AMReX-Astro/initial_models</a>) has the routines used
for creating initial models.  Here are the names of the <code class="docutils literal notranslate"><span class="pre">initial_models</span></code>
directories used for different problems:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>problem name</p></th>
<th class="head"><p>initial_models routine</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reacting_bubble</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">test_convect</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test2</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wdconvect</span></code></p></td>
<td><p>none</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">spherical_heat</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">spherical</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The model data is not generated at run-time—it must be generated in
advance of running any MAESTROeX examples. The inputs file should point
to the file containing the model data.</p>
</section>
<section id="creating-the-initial-data-from-the-model-data">
<h2>Creating the Initial Data from the Model Data<a class="headerlink" href="#creating-the-initial-data-from-the-model-data" title="Link to this heading"></a></h2>
<p>In base_state.f90, using the subroutine
init_base_state (which is actually a terrible name since we
are computing 1D initial data, which is not quite the same thing
as the base satte), we set the initial
data <span class="math notranslate nohighlight">\(\rho^{\init}, T^{\init}, p^{\init}\)</span> and <span class="math notranslate nohighlight">\(X^{\init}\)</span> equal to the
model data. Then, we set <span class="math notranslate nohighlight">\(p^{\init},h^{\init} =
p,h(\rho^{\init},T^{\init},X^{\init})\)</span> through the EOS. Note that
we overwrite the existing value of <span class="math notranslate nohighlight">\(p^{\init}\)</span> but this should not change
the value since we called
<span class="math notranslate nohighlight">\(p^{\model} = p^{\model}(\rho^{\model},T^{\model},X^{\model})\)</span> at the end of the
initial model generation routines in
§ <a class="reference external" href="#Sec:CreatingtheModelDatafromRawData">1</a>.</p>
<p>For multilevel planar problems, we generate initial data at the
non-finest levels by using linear interpolation from the two nearest
model points (see the figure below). Note that the initial data is not
in HSE nor is it thermodynamically consistent on non-finest cells. We
will enforce these on the base state and full state later.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/multilevel_init.png"><img alt="_images/multilevel_init.png" src="_images/multilevel_init.png" style="width: 10%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Multilevel Initialization. The data from the initial model
is represented by the dots on the right. The initial data at the
finest level is represented by the circles. The initial data at
non-finest levels is represented by the squares. We copy data from
the dots directly into the circles. We use linear interpolation
using the two nearest points to copy data from the dots to the
squares.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>We deal with the edge of the star by tracking the first coarse cell
in which the density falls below base_cutoff_density. We note
the radius of this cell center, and the values of <span class="math notranslate nohighlight">\(\rho\)</span>, <span class="math notranslate nohighlight">\(\rho h\)</span>, <span class="math notranslate nohighlight">\(X_k\)</span>,
<span class="math notranslate nohighlight">\(p\)</span>, and <span class="math notranslate nohighlight">\(T\)</span> in this cells. Then, at every level, if current cell-center
is above this radius, we set the state equal to this stored state. This
ensures a consistent treatment of the edge of the star at all levels.</p>
</section>
<section id="creating-the-base-state-and-full-state">
<span id="sec-creating-the-base-state-and-full-state"></span><h2>Creating the Base State and Full State<a class="headerlink" href="#creating-the-base-state-and-full-state" title="Link to this heading"></a></h2>
<p>Given <span class="math notranslate nohighlight">\(p^{\init}, \rho^{\init}, T^{\init},\)</span> and <span class="math notranslate nohighlight">\(X^{\init}\)</span>, this
section describes how the base state (<span class="math notranslate nohighlight">\(\rho_0\)</span> and <span class="math notranslate nohighlight">\(p_0\)</span>) and full
state (<span class="math notranslate nohighlight">\(\rho, h, X\)</span>, and <span class="math notranslate nohighlight">\(T\)</span>) are computed. The base state is, general, not
simply a direct copy of the initial model data, since we require that
<span class="math notranslate nohighlight">\(\rho_0 = \overline\rho\)</span>. Additionally, we require thebase state to
be HSE according to <a class="reference internal" href="#equation-eq-hse-discretization">Eq.96</a>, and that the full
state is thermodynamically consistent with <span class="math notranslate nohighlight">\(p_0\)</span>. Overall we do:</p>
<ol class="arabic simple">
<li><p>Fill <span class="math notranslate nohighlight">\(\rho^{\init}, h^{\init}, X^{\init}\)</span>, and <span class="math notranslate nohighlight">\(T^{\init}\)</span> onto a
multifab to obtain the full state <span class="math notranslate nohighlight">\(\rho, h, X\)</span>, and <span class="math notranslate nohighlight">\(T\)</span>.</p></li>
<li><p>If perturb_model = T, a user-defined perturbation is
added. This routine should make sure that the EOS is called so that
there is some sense of thermodynamic consistency.</p></li>
<li><p>Set <span class="math notranslate nohighlight">\(\rho_0 = \overline\rho\)</span>.</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(p_0\)</span> using enforce_HSE.</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(T,h = T,h(\rho,p_0,X_k)\)</span>.</p></li>
<li><p>Set <span class="math notranslate nohighlight">\((\rho h)_0 = \overline{(\rho h)}\)</span>.</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(\overline{T}\)</span>. Note that we only use <span class="math notranslate nohighlight">\(\overline{T}\)</span> as
a diagnostic and as a seed for EOS calls.</p></li>
</ol>
<p>Now <span class="math notranslate nohighlight">\(\rho_0 = \overline\rho\)</span>, the base state is in HSE, and the full
state is thermodynamically consistent with <span class="math notranslate nohighlight">\(p_0\)</span>.</p>
<section id="coarse-fine-enforce-hse-discretization">
<span id="sec-coarse-fine-hse-discretization"></span><h3>Coarse-Fine enforce_HSE Discretization<a class="headerlink" href="#coarse-fine-enforce-hse-discretization" title="Link to this heading"></a></h3>
<p>When integrating the HSE discretization upward, we must use a
different differencing procedure at coarse-fine interfaces.  The
figure below shows the transition from coarse (level
<span class="math notranslate nohighlight">\(l-1\)</span>) to fine (level <span class="math notranslate nohighlight">\(l\)</span>), with the zone center indices
noted.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/ctof.png"><img alt="_images/ctof.png" src="_images/ctof.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">A coarse-fine interface in the 1-d base state</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>To find the zone-centered pressure in the first fine zone, <span class="math notranslate nohighlight">\(p_r^l\)</span>, from
the zone-centered pressure in the coarse zone just below the coarse-fine interface,
<span class="math notranslate nohighlight">\(p_{r/2-1}^{l-1}\)</span>, we integrate in 2 steps. We allow for a spatially
changing gravitational acceleration, for complete generality.</p>
<p>First we integrate up to the
coarse-fine interface from the coarse-cell center as:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-1">
<span class="eqno">(97)<a class="headerlink" href="#equation-initial-models-1" title="Link to this equation"></a></span>\[\frac{p_{r-\myhalf}^l - p_{r/2-1}^{l-1}}{\Delta r^{l-1}/2} =
  \frac{\rho_{r-\myhalf}^l + \rho_{r/2-1}^{l-1}}{2}  \,
  \frac{g_{r-\myhalf}^l + g_{r/2-1}^{l-1}}{2}\]</div>
<p>We can rewrite this as an expression for the pressure at the coarse-fine interface:</p>
<div class="math notranslate nohighlight" id="equation-eq-ctoi">
<span class="eqno">(98)<a class="headerlink" href="#equation-eq-ctoi" title="Link to this equation"></a></span>\[p_{r-\myhalf}^l = p_{r/2-1}^{l-1} + \frac{\Delta r^{l-1}}{8}
  \left(\rho_{r-\myhalf}^l + \rho_{r/2-1}^{l-1}\right)
  \left(g_{r-\myhalf}^l + g_{r/2-1}^{l-1}\right).\]</div>
<p>Next we integrate up from the coarse-fine interface to the fine-cell center:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-2">
<span class="eqno">(99)<a class="headerlink" href="#equation-initial-models-2" title="Link to this equation"></a></span>\[\frac{p_r^l - p_{r-\myhalf}^l}{\Delta r^l/2} =
  \frac{\rho_r^l + \rho_{r-\myhalf}^l}{2} \,
  \frac{g_r^l + g_{r-\myhalf}^l}{2}\]</div>
<p>We can rewrite this as an expression for the pressure at the fine-cell center:</p>
<div class="math notranslate nohighlight" id="equation-eq-itof">
<span class="eqno">(100)<a class="headerlink" href="#equation-eq-itof" title="Link to this equation"></a></span>\[p_r^l = p_{r-\myhalf}^l + \frac{\Delta r^l}{8}
  \left(\rho_r^l + \rho_{r-\myhalf}^l\right)
  \left(g_r^l + g_{r-\myhalf}^l\right).\]</div>
<p>Combining <a class="reference internal" href="#equation-eq-ctoi">Eq.98</a> and <a class="reference internal" href="#equation-eq-itof">Eq.100</a> gives</p>
<div class="math notranslate nohighlight" id="equation-initial-models-3">
<span class="eqno">(101)<a class="headerlink" href="#equation-initial-models-3" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
p_r^l = p_{r/2-1}^{l-1} &amp;+
     \frac{\Delta r^{l-1}}{8} \left(\rho_{r-\myhalf}^l + \rho_{r/2-1}^{l-1}\right)
                                \left(   g_{r-\myhalf}^l +    g_{r/2-1}^{l-1}\right) \nonumber \\
 &amp;+ \frac{\Delta r^l}{8} \left(\rho_r^l + \rho_{r-\myhalf}^l\right)
                            \left(   g_r^l +    g_{r-\myhalf}^l\right).\end{align}\end{split}\]</div>
<p>We can simplify using</p>
<div class="math notranslate nohighlight" id="equation-initial-models-4">
<span class="eqno">(102)<a class="headerlink" href="#equation-initial-models-4" title="Link to this equation"></a></span>\[\Delta r^{l-1} = 2\Delta r^l,\]</div>
<p>and by interpolating the cell-centered densities to the coarse-fine interface as:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-5">
<span class="eqno">(103)<a class="headerlink" href="#equation-initial-models-5" title="Link to this equation"></a></span>\[\rho_{r-\myhalf}^l = \frac{2}{3}\rho_r^l + \frac{1}{3}\rho_{r/2-1}^{l-1}.\]</div>
<p>Because we carry both the cell- and edge-centered gravitational accelerations, we
do not need to interpolate <span class="math notranslate nohighlight">\(g\)</span> to the interface.
Simplifying, we have</p>
<div class="math notranslate nohighlight" id="equation-initial-models-6">
<span class="eqno">(104)<a class="headerlink" href="#equation-initial-models-6" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
p_r^l = p_{r/2-1}^{l-1} &amp;+
   \frac{\Delta r^l}{4}\left(\frac{2}{3}\rho_r^l +
                             \frac{4}{3}\rho_{r/2-1}^{l-1} \right)
                       \left(   g_{r-\myhalf}^l +    g_{r/2-1}^{l-1}\right) \nonumber \\
  &amp;+ \frac{\Delta r^l}{8}\left(\frac{5}{3}\rho_r^l +
                                  \frac{1}{3}\rho_{r/2-1}^{l-1}\right)
                       \left(   g_r^l +    g_{r-\myhalf}^l\right)  .\end{align}\end{split}\]</div>
<p>Finally, we note for constant <span class="math notranslate nohighlight">\(g\)</span>, this simplifies to:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-7">
<span class="eqno">(105)<a class="headerlink" href="#equation-initial-models-7" title="Link to this equation"></a></span>\[p_r^l = p_{r/2-1}^{l-1} +
  \frac{3\Delta r^l g}{4}\left(\rho_{r/2-1}^{l-1} + \rho_r^l\right).\label{Coarse-Fine Stencil}\]</div>
<p>When integrating across a fine-coarse interface (see the figure
below), the proceduce is similar.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/ftoc.png"><img alt="_images/ftoc.png" src="_images/ftoc.png" style="width: 40%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">A fine-coarse interface in the 1-d base state</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The expression for general gravity becomes:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-8">
<span class="eqno">(106)<a class="headerlink" href="#equation-initial-models-8" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
p_{(r+1)/2}^{l-1} = p_{r}^l &amp;+
   \frac{\Delta r^l}{4}\left(\frac{2}{3}\rho_r^l +
                             \frac{4}{3}\rho_{(r+1)/2}^{l-1} \right)
                       \left(   g_{(r+1)/2 -\myhalf}^{l-1} +    g_{(r+1)/2}^{l-1}\right) \nonumber \\
  &amp;+ \frac{\Delta r^l}{8}\left(\frac{5}{3}\rho_r^l +
                                  \frac{1}{3}\rho_{(r+1)/2}^{l-1}\right)
                       \left(   g_r^l +    g_{(r+1)/2 -\myhalf}^{l-1} \right)  .\end{align}\end{split}\]</div>
<p>and for spatially-constant gravity, it simplifies to:</p>
<div class="math notranslate nohighlight" id="equation-initial-models-9">
<span class="eqno">(107)<a class="headerlink" href="#equation-initial-models-9" title="Link to this equation"></a></span>\[p_{(r+1)/2}^{l-1} = p_{r}^l + \frac{3\Delta r^l g}{4}\left(\rho_{r}^l+\rho_{(r+1)/2}^{l-1}\right).\label{Fine-Coarse Stencil}\]</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runtime_parameters.html" class="btn btn-neutral float-left" title="namespace: maestro" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gpu.html" class="btn btn-neutral float-right" title="GPU" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, MAESTROeX development tem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>