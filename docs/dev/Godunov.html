<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Godunov Interface States &mdash; MAESTROeX  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=10589de1" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "macros": {"rhozero": "{\\rho_0}", "pizero": "{\\pi_0}", "pizeroone": "{\\pi_0^{(1)}}", "pizerotwo": "{\\pi_0^{(2)}}", "gammabar": "{\\overline{\\Gamma}_1}", "ptl": "{\\partial}", "eb": "{{\\bf e}}", "fb": "{{\\bf f}}", "ib": "{{\\bf i}}", "Ub": "{{\\bf U}}", "Vb": "{{\\bf V}}", "xb": "{{\\bf x}}", "ut": "{{\\tilde{u}}}", "vt": "{{\\tilde{v}}}", "wt": "{{\\tilde{w}}}", "Ubt": "{\\widetilde{\\Ub}}", "edge": "{{\\rm EDGE}}", "mac": "{{\\rm MAC}}", "trans": "{{\\rm TRANS}}", "nablab": "{\\mathbf{\\nabla}}", "cdotb": "{\\mathbf{\\cdot}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\frac{1}{2}}", "nph": "{{n + \\myhalf}}", "nmh": "{{n - \\myhalf}}", "Hext": "{{H_{\\rm ext}}}", "Hnuc": "{{H_{\\rm nuc}}}", "kth": "{k_{\\rm th}}", "init": "{\\rm init}", "model": "{\\rm model}", "raw": "{\\rm raw}", "pred": "{{\\rm pred}}", "Sbar": "{\\overline{S}}", "inp": "{\\mathrm{in}}", "initp": "{\\mathrm{init}}", "outp": "{\\mathrm{out}}", "uadv": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvone": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV},\\star}}", "uadvonedag": "{\\Ubt^{\\mathrm{ADV},\\dagger,\\star}}", "uadvtwo": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvtwodag": "{\\Ubt^{\\mathrm{ADV},\\dagger}}", "uadvsdcstar": "{\\mathbf{U}^{\\mathrm{ADV},\\star}}", "uadvsdcpred": "{\\mathbf{U}^{\\mathrm{ADV},\\mathrm{pred}}}", "uadvsdc": "{\\mathbf{U}^{\\mathrm{ADV}}}", "dt": "{\\Delta t}", "dr": "{\\Delta r}", "etarho": "{\\eta_{\\rho}}", "etarhoec": "{\\etarho^{\\rm ec}}", "etarhocc": "{\\etarho^{\\rm cc}}", "etarhoflux": "{\\etarho^{\\rm flux}}", "divetarho": "{\\nabla\\cdot(\\etarho\\eb_r)}", "ow": "{\\overline{w}_0}", "dw": "{\\delta w_0}", "thalf": "{\\frac{3}{2}}", "rhop": "{{\\rho^{\\prime}}}", "omegadot": "{\\dot{\\omega}}", "er": "{\\mathbf{e}_r}", "ex": "{\\mathbf{e}_x}", "ey": "{\\mathbf{e}_y}", "ez": "{\\mathbf{e}_z}", "Omegab": "{{\\bf \\Omega}}", "rb": "{{\\bf r}}", "boxtype": "{{\\tt box\\/}}", "fab": "{{\\tt fab\\/}}", "multifab": "{{\\tt multifab\\/}}", "boxarray": "{{\\tt boxarray\\/}}", "mlboxarray": "{{\\tt ml\\_boxarray\\/}}", "layout": "{{\\tt layout\\/}}", "mllayout": "{{\\tt ml\\_layout\\/}}", "bctower": "{{\\tt bc\\_tower\\/}}", "bclevel": "{{\\tt bc\\_level\\/}}", "mgtower": "{{\\tt mg\\_tower\\/}}", "bndryreg": "{{\\tt bndry\\_reg\\/}}", "runparam": ["{\\index{Runtime parameters!{\\tt #1}}{\\tt #1}}", 1], "runparamidx": ["{\\index{Runtime parameters!{\\tt #1}}}", 1], "code": ["{\\index{Code reference!{\\tt #1}}{\\tt #1}}", 1], "codeidx": ["{\\index{Code reference!{\\tt #1}}}", 1], "otherindex": ["{\\index{#1!#2}}", 2], "fdamp": "{{f_\\mathrm{damp}}}"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multigrid" href="mg.html" />
    <link rel="prev" title="Interface State Details" href="pert.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            MAESTROeX
              <img src="_static/maestroex_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="../Godunov.html">main</a> | <a href="./Godunov.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">MAESTROeX basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html">Governing Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html#numerical-methodology">Numerical Methodology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using MAESTROeX</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="addproblem.html">Adding A New Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="param_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial_models.html">Initial Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_state.html">Base State</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="makefiles.html">MAESTROeX Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="managingjobs.html">Managing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MAESTROeX technical details</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lo_density.html">Low Density Cutoffs</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume_discrepancy.html">Volume Discrepancy Factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="eos_notes.html">Equation of State Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html">The Mixing Term, <span class="math notranslate nohighlight">\(\etarho\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#eta-flow-chart"><span class="math notranslate nohighlight">\(\eta\)</span> Flow Chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#computing-etarhoec-and-etarhocc">Computing <span class="math notranslate nohighlight">\(\etarhoec\)</span> and <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhoec">Using <span class="math notranslate nohighlight">\(\etarhoec\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhocc">Using <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="pert.html">Interface State Details</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Godunov Interface States</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#maestroex-notation">MAESTROeX Notation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#computing-ub-from-ubt">Computing <span class="math notranslate nohighlight">\(\Ub\)</span> From <span class="math notranslate nohighlight">\(\Ubt\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-partial-w-0-partial-r">Computing <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-ubt-trans-in-maestroex">Computing <span class="math notranslate nohighlight">\(\Ubt^{\trans}\)</span> in MAESTROeX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case">2D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-1">3D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-spherical-case">3D Spherical Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-ubt-mac-in-maestroex">Computing <span class="math notranslate nohighlight">\(\Ubt^{\mac,*}\)</span> in MAESTROeX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-2">2D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-3">3D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-spherical-case-1">3D Spherical Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-rho-edge-x-k-edge-rho-h-edge-and-ubt-edge-in-maestroex">Computing <span class="math notranslate nohighlight">\(\rho^{'\edge}, X_k^{\edge},(\rho h)^{'\edge}\)</span>, and <span class="math notranslate nohighlight">\(\Ubt^{\edge}\)</span> in MAESTROeX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-4">2D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-5">3D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-spherical-case-2">3D Spherical Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-ub-mac-in-varden">Computing <span class="math notranslate nohighlight">\(\Ub^{\mac,*}\)</span> in VARDEN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-6">2D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-7">3D Cartesian Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-ub-edge-and-rho-edge-in-varden">Computing <span class="math notranslate nohighlight">\(\Ub^{\edge}\)</span> and <span class="math notranslate nohighlight">\(\rho^{\edge}\)</span> in VARDEN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-8">2D Cartesian Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-cartesian-case-9">3D Cartesian Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#estate-fpu-in-godunov-2d-3d-f">ESTATE_FPU in GODUNOV_2D/3D.f</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estate-in-godunov-2d-3d-f">ESTATE in GODUNOV_2D/3D.f</a></li>
<li class="toctree-l2"><a class="reference internal" href="#piecewise-parabolic-method-ppm">Piecewise Parabolic Method (PPM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#colella-and-woodward-based-approach">Colella and Woodward Based Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="#colella-and-sekora-based-approach">Colella and Sekora Based Approach</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mg.html">Multigrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation in MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="spherical_basestate.html">Modifications for a Spherical Self-Gravitating Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="planar_invsq_basestate.html">Modifications for a <span class="math notranslate nohighlight">\(1/r^2\)</span> Plane-Parallel Basestate</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermo_notes.html">Notes on Thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="beta0.html">Notes on <span class="math notranslate nohighlight">\(\beta_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="enthalpy.html">Notes on Enthalpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="regtest.html">Regression Testing and Continuous Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAESTROeX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Godunov Interface States</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Godunov.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="godunov-interface-states">
<h1>Godunov Interface States<a class="headerlink" href="#godunov-interface-states" title="Link to this heading"></a></h1>
<p>These are working notes for the Godunov step in MAESTROeX and VARDEN.</p>
<section id="maestroex-notation">
<h2>MAESTROeX Notation<a class="headerlink" href="#maestroex-notation" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>For 2D, <span class="math notranslate nohighlight">\(\Ub = (u,w)\)</span> and <span class="math notranslate nohighlight">\(\Ubt = (\ut,\wt)\)</span>.
Note that <span class="math notranslate nohighlight">\(u = \ut\)</span>. We will use the shorthand <span class="math notranslate nohighlight">\(\ib = (x,r)\)</span>.</p></li>
<li><p>For 3D plane parallel, <span class="math notranslate nohighlight">\(\Ub = (u,v,w)\)</span>
and <span class="math notranslate nohighlight">\(\Ubt = (\ut,\vt,\wt)\)</span>. Note that <span class="math notranslate nohighlight">\(u = \ut\)</span> and <span class="math notranslate nohighlight">\(v = \vt\)</span>.
We will use the shorthand <span class="math notranslate nohighlight">\(\ib = (x,y,r)\)</span>.</p></li>
<li><p>For 3D spherical, <span class="math notranslate nohighlight">\(\Ub = (u,v,w)\)</span>
and <span class="math notranslate nohighlight">\(\Ubt = (\ut,\vt,\wt)\)</span>. We will use the shorthand
<span class="math notranslate nohighlight">\(\ib = (x,y,z)\)</span>.</p></li>
</ul>
<section id="computing-ub-from-ubt">
<h3>Computing <span class="math notranslate nohighlight">\(\Ub\)</span> From <span class="math notranslate nohighlight">\(\Ubt\)</span><a class="headerlink" href="#computing-ub-from-ubt" title="Link to this heading"></a></h3>
<p>For plane-parallel problems, in order to compute <span class="math notranslate nohighlight">\(w\)</span> from
<span class="math notranslate nohighlight">\(\wt\)</span>, we use simple averaging</p>
<div class="math notranslate nohighlight" id="equation-godunov-0">
<span class="eqno">(163)<a class="headerlink" href="#equation-godunov-0" title="Link to this equation"></a></span>\[w_{\ib}^n = \wt_{\ib}^n + \frac{w_{0,r-\half} + w_{0,r+\half}}{2}.\]</div>
<p>For spherial problems, in order to compute <span class="math notranslate nohighlight">\(\Ub\)</span> from <span class="math notranslate nohighlight">\(\Ubt\)</span>,
we first map <span class="math notranslate nohighlight">\(w_0\)</span> onto <span class="math notranslate nohighlight">\(w_0^{\mac}\)</span> using put_w0_on_edges,
where <span class="math notranslate nohighlight">\(w_0^{\mac}\)</span> only contains normal velocities at each face.
Then we construct <span class="math notranslate nohighlight">\(\Ub\)</span> by using</p>
<div class="math notranslate nohighlight" id="equation-godunov-1">
<span class="eqno">(164)<a class="headerlink" href="#equation-godunov-1" title="Link to this equation"></a></span>\[u_{\ib} = \ut_{\ib} + \frac{w_{0,\ib+\half\eb_x}^{\mac} + w_{0,\ib-\half\eb_x}^{\mac}}{2},\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-2">
<span class="eqno">(165)<a class="headerlink" href="#equation-godunov-2" title="Link to this equation"></a></span>\[v_{\ib} = \vt_{\ib} + \frac{w_{0,\ib+\half\eb_y}^{\mac} + w_{0,\ib-\half\eb_y}^{\mac}}{2},\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-3">
<span class="eqno">(166)<a class="headerlink" href="#equation-godunov-3" title="Link to this equation"></a></span>\[w_{\ib} = \wt_{\ib} + \frac{w_{0,\ib+\half\eb_z}^{\mac} + w_{0,\ib-\half\eb_z}^{\mac}}{2}.\]</div>
<p>To compute full edge-state velocities, simply add <span class="math notranslate nohighlight">\(w_0\)</span>
(for plane-parallel) or w0mac to the perturbational
velocity directly since only edge-based quantities are involved.</p>
</section>
<section id="computing-partial-w-0-partial-r">
<h3>Computing <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span><a class="headerlink" href="#computing-partial-w-0-partial-r" title="Link to this heading"></a></h3>
<p>For plane-parallel problems, the spatial derivatives of <span class="math notranslate nohighlight">\(w_0\)</span>
are given by the two-point centered difference:</p>
<div class="math notranslate nohighlight" id="equation-godunov-4">
<span class="eqno">(167)<a class="headerlink" href="#equation-godunov-4" title="Link to this equation"></a></span>\[\left(\frac{\partial w_0}{\partial r}\right)_{\ib} = \frac{w_{0,r+\half}-w_{0,r-\half}}{h}.\]</div>
<p>For spherical problems, we compute the radial bin centered gradient using</p>
<div class="math notranslate nohighlight" id="equation-godunov-5">
<span class="eqno">(168)<a class="headerlink" href="#equation-godunov-5" title="Link to this equation"></a></span>\[\left(\frac{\partial w_0}{\partial r}\right)_{r} = \frac{w_{0,r+\half}-w_{0,r-\half}}{\Delta r}.\]</div>
<p>Then we put <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> onto a Cartesian grid
using put_1d_array_on_cart_3d_sphr.</p>
</section>
</section>
<section id="computing-ubt-trans-in-maestroex">
<h2>Computing <span class="math notranslate nohighlight">\(\Ubt^{\trans}\)</span> in MAESTROeX<a class="headerlink" href="#computing-ubt-trans-in-maestroex" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">In advance_premac, we call mkutrans, to compute
<span class="math notranslate nohighlight">\(\Ubt^{\trans}\)</span>. We will only compute the normal
component of velocity at each face.
These transverse velocities do not contain <span class="math notranslate nohighlight">\(w_0\)</span>, so immediately
following the call to mkutrans, we call addw0 to compute
<span class="math notranslate nohighlight">\(\Ub^{\trans}\)</span> from <span class="math notranslate nohighlight">\(\Ubt^{\trans}\)</span>.</div>
<div class="line">The evolution equation for the perturbational velocity is:</div>
</div>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-godunov-6">
<span class="eqno">(169)<a class="headerlink" href="#equation-godunov-6" title="Link to this equation"></a></span>\[\frac{\partial\Ubt}{\partial t} = -\Ub\cdot\nabla\Ubt \underbrace{- (\Ubt\cdot\eb_r)\frac{\partial w_0}{\partial r}\eb_r - \frac{1}{\rho}\nabla\pi + \frac{1}{\rho_0}\frac{\partial\pi_0}{\partial r}\eb_r - \frac{(\rho-\rho_0)}{\rho}g\eb_r}_{\hbox{forcing terms}}.\label{Perturbational Velocity Equation}\]</div>
<p>We extrapolate each velocity component to edge-centered, time-centered locations. For example,</p>
<div class="math notranslate nohighlight" id="equation-godunov-7">
<span class="eqno">(170)<a class="headerlink" href="#equation-godunov-7" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{R,\ib-\half\eb_x} &amp;=&amp; \ut_{\ib}^n + \frac{h}{2}\frac{\partial\ut_{\ib}^n}{\partial x} + \frac{\dt}{2}\frac{\partial\ut_{\ib}^n}{\partial t} \nonumber \\
&amp;=&amp; \ut_{\ib}^n + \frac{h}{2}\frac{\partial\ut_{\ib}^n}{\partial x} + \frac{\dt}{2}
\left(-\ut_{\ib}^n\frac{\partial\ut_{\ib}^n}{\partial x} - \wt_{\ib}^n\frac{\partial\ut_{\ib}^n}{\partial r} + \text{forcing terms}\right)\end{aligned}\end{split}\]</div>
<p>We are going to use a 1D Taylor series extrapolation in space and time.
By 1D, we mean that we omit any spatial derivatives that are not in the
direction of the extrapolation. We also omit the underbraced forcing terms.
We also use characteristic tracing.</p>
<div class="math notranslate nohighlight" id="equation-godunov-8">
<span class="eqno">(171)<a class="headerlink" href="#equation-godunov-8" title="Link to this equation"></a></span>\[\ut_{R,\ib-\half\eb_x} = \ut_{\ib}^n + \left[\frac{1}{2} - \frac{\dt}{2h}\min(0,\ut_{\ib}^n)\right]\partial\ut_{\ib}^n\]</div>
</div></blockquote>
<section id="d-cartesian-case">
<h3>2D Cartesian Case<a class="headerlink" href="#d-cartesian-case" title="Link to this heading"></a></h3>
<p>We predict <span class="math notranslate nohighlight">\(\ut\)</span> to x-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-9">
<span class="eqno">(172)<a class="headerlink" href="#equation-godunov-9" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_x} &amp;=&amp; \ut_{\ib-\eb_x}^n + \left[\half - \frac{\dt}{2h}\max(0,u_{\ib-\eb_x}^n)\right]\Delta_x \ut_{\ib-\eb_x}^n,\\
\ut_{R,\ib-\half\eb_x} &amp;=&amp; \ut_{\ib}^n - \left[\half + \frac{\dt}{2h}\min(0,u_{\ib}^n)\right]\Delta_x \ut_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>We pick the final trans states using a Riemann solver:</p>
<div class="math notranslate nohighlight" id="equation-godunov-10">
<span class="eqno">(173)<a class="headerlink" href="#equation-godunov-10" title="Link to this equation"></a></span>\[\begin{split}\ut^{\trans}_{\ib-\half\eb_x} =
\begin{cases}
0, &amp; \left(\ut_{L,\ib-\half\eb_x} \le 0 ~~ {\rm AND} ~~ \ut_{R,\ib-\half\eb_x} \ge 0\right) ~~ {\rm OR} ~~ \left|\ut_{L,\ib-\half\eb_x} + \ut_{R,\ib-\half\eb_x}\right| &lt; \epsilon, \\
\ut_{L,\ib-\half\eb_x}, &amp; \ut_{L,\ib-\half\eb_x} + \ut_{R,\ib-\half\eb_x} &gt; 0, \\
\ut_{R,\ib-\half\eb_x}, &amp; \ut_{L,\ib-\half\eb_x} + \ut_{R,\ib-\half\eb_x} &lt; 0, \\
\end{cases}\end{split}\]</div>
<p>We predict <span class="math notranslate nohighlight">\(\wt\)</span> to r-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-11">
<span class="eqno">(174)<a class="headerlink" href="#equation-godunov-11" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\wt_{L,\ib-\half\eb_r} &amp;=&amp; \wt_{\ib-\eb_r}^n + \left[\half - \frac{\dt}{2h}\max(0,w_{\ib-\eb_r}^n)\right]\Delta_r \wt_{\ib-\eb_r}^n,\\
\wt_{R,\ib-\half\eb_r} &amp;=&amp; \wt_{\ib}^n - \left[\half + \frac{\dt}{2h}\min(0,w_{\ib}^n)\right]\Delta_r \wt_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>We pick the final <span class="math notranslate nohighlight">\(\trans\)</span> states using a Riemann solver, noting
that we upwind based on the full velocity.</p>
<div class="math notranslate nohighlight" id="equation-godunov-12">
<span class="eqno">(175)<a class="headerlink" href="#equation-godunov-12" title="Link to this equation"></a></span>\[\begin{split}\wt^{\trans}_{\ib-\half\eb_r} =
\begin{cases}
0, &amp; \left(w_{L,\ib-\half\eb_r} \le 0 ~~ {\rm AND} ~~ w_{R,\ib-\half\eb_r} \ge 0\right) ~~ {\rm OR} ~~ \left|w_{L,\ib-\half\eb_r} + w_{R,\ib-\half\eb_r}\right| &lt; \epsilon, \\
\wt_{L,\ib-\half\eb_r}, &amp; w_{L,\ib-\half\eb_r} + w_{R,\ib-\half\eb_r} &gt; 0, \\
\wt_{R,\ib-\half\eb_r}, &amp; w_{L,\ib-\half\eb_r} + w_{R,\ib-\half\eb_r} &lt; 0, \\
\end{cases}\end{split}\]</div>
</section>
<section id="d-cartesian-case-1">
<span id="id1"></span><h3>3D Cartesian Case<a class="headerlink" href="#d-cartesian-case-1" title="Link to this heading"></a></h3>
<p>We use the exact same procedure in 2D and 3D to compute <span class="math notranslate nohighlight">\(\ut^{\trans}\)</span> and
<span class="math notranslate nohighlight">\(\wt^{\trans}\)</span>. The procedure for computing <span class="math notranslate nohighlight">\(\vt^{\trans}\)</span> is analogous to
computing <span class="math notranslate nohighlight">\(\ut^{\trans}\)</span>. We predict <span class="math notranslate nohighlight">\(\vt\)</span> to y-faces using the
1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-13">
<span class="eqno">(176)<a class="headerlink" href="#equation-godunov-13" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\vt_{L,\ib-\half\eb_y} &amp;=&amp; \vt_{\ib-\eb_y}^n + \left[\half - \frac{\dt}{2h}\max(0,v_{\ib-\eb_y}^n)\right]\Delta_y \vt_{\ib-\eb_y}^n, \\
\vt_{R,\ib-\half\eb_y} &amp;=&amp; \vt_{\ib}^n - \left[\half + \frac{\dt}{2h}\min(0,v_{\ib}^n)\right]\Delta_y \vt_{\ib}^n,\end{aligned}\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-14">
<span class="eqno">(177)<a class="headerlink" href="#equation-godunov-14" title="Link to this equation"></a></span>\[\begin{split}\vt^{\trans}_{\ib-\half\eb_y} =
\begin{cases}
0, &amp; \left(v_{L,\ib-\half\eb_y} \le 0 ~~ {\rm AND} ~~ v_{R,\ib-\half\eb_y} \ge 0\right) ~~ {\rm OR} ~~ \left|v_{L,\ib-\half\eb_y} + v_{R,\ib-\half\eb_y}\right| &lt; \epsilon, \\
\vt_{L,\ib-\half\eb_y}, &amp; v_{L,\ib-\half\eb_y} + v_{R,\ib-\half\eb_y} &gt; 0, \\
\vt_{R,\ib-\half\eb_y}, &amp; v_{L,\ib-\half\eb_y} + v_{R,\ib-\half\eb_y} &lt; 0. \\
\end{cases}\end{split}\]</div>
</section>
<section id="d-spherical-case">
<h3>3D Spherical Case<a class="headerlink" href="#d-spherical-case" title="Link to this heading"></a></h3>
<p>We predict the normal components of velocity to the normal faces
using a 1D extrapolation. The equations for all three directions
are identical to those given in the 2D and 3D plane-parallel
sections. As in the plane-parallel case, make sure
that the advection velocities, as well as
the upwind velocity, is done with the full velocity, not the
perturbational velocity.</p>
</section>
</section>
<section id="computing-ubt-mac-in-maestroex">
<h2>Computing <span class="math notranslate nohighlight">\(\Ubt^{\mac,*}\)</span> in MAESTROeX<a class="headerlink" href="#computing-ubt-mac-in-maestroex" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">In advance_premac, we call velpred to compute
<span class="math notranslate nohighlight">\(\Ubt^{\mac,*}\)</span>. We will only compute the normal component of
velocity at each face.</div>
<div class="line">For reference, here is the perturbational velocity equation from before:</div>
</div>
<blockquote>
<div><div class="math notranslate nohighlight" id="equation-godunov-15">
<span class="eqno">(178)<a class="headerlink" href="#equation-godunov-15" title="Link to this equation"></a></span>\[\frac{\partial\Ubt}{\partial t} = -\Ub\cdot\nabla\Ubt \underbrace{- (\Ubt\cdot\eb_r)\frac{\partial w_0}{\partial r}\eb_r \underbrace{- \frac{1}{\rho}\nabla\pi + \frac{1}{\rho_0}\frac{\partial\pi_0}{\partial r}\eb_r - \frac{(\rho-\rho_0)}{\rho}g\eb_r}_{\hbox{terms included in $\fb_{\Ubt}$}}}_{\hbox{forcing terms}}.\]</div>
<p>Note that the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term is treated like a forcing
term, but it is not actually part of <span class="math notranslate nohighlight">\(\fb_{\Ubt}\)</span>. We make use of the 1D
extrapolations used to compute <span class="math notranslate nohighlight">\(\Ubt^{\trans}\)</span>
(<span class="math notranslate nohighlight">\(\ut_{L/R,\ib-\half\eb_x}\)</span>, <span class="math notranslate nohighlight">\(\vt_{L/R,\ib-\half\eb_y}\)</span>,
and <span class="math notranslate nohighlight">\(\wt_{L/R,\ib-\half\eb_r}\)</span>), as well as the “<span class="math notranslate nohighlight">\(\trans\)</span>” states
(<span class="math notranslate nohighlight">\(\ut_{\ib-\half\eb_x}^{\trans}\)</span>, <span class="math notranslate nohighlight">\(\vt_{\ib-\half\eb_y}^{\trans}\)</span>,
and <span class="math notranslate nohighlight">\(\wt_{\ib-\half\eb_r}^{\trans}\)</span>)</p>
</div></blockquote>
<section id="d-cartesian-case-2">
<span id="id2"></span><h3>2D Cartesian Case<a class="headerlink" href="#d-cartesian-case-2" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to x-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to r-faces using a full-dimensional extrapolation.</p></li>
</ol>
<p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-16">
<span class="eqno">(179)<a class="headerlink" href="#equation-godunov-16" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_r} &amp;=&amp; \ut_{\ib-\eb_r}^n + \left[\half - \frac{\dt}{2h}\max(0,w_{\ib-\eb_r}^n)\right]\Delta_r \ut_{\ib-\eb_r}^n, \\
\ut_{R,\ib-\half\eb_r} &amp;=&amp; \ut_{\ib} - \left[\half + \frac{\dt}{2h}\min(0,w_{\ib}^n)\right]\Delta_r \ut_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(w^{\trans}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-17">
<span class="eqno">(180)<a class="headerlink" href="#equation-godunov-17" title="Link to this equation"></a></span>\[\begin{split}\ut_{\ib-\half\eb_r} =
\begin{cases}
\half\left(\ut_{L,\ib-\half\eb_r} + \ut_{R,\ib-\half\eb_r}\right), &amp; \left|w^{\trans}_{\ib-\half\eb_r}\right| &lt; \epsilon \\
\ut_{L,\ib-\half\eb_r}, &amp; w^{\trans}_{\ib-\half\eb_r} &gt; 0, \\
\ut_{R,\ib-\half\eb_r}, &amp; w^{\trans}_{\ib-\half\eb_r} &lt; 0. \\
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to x-faces using a full-dimensional extrapolation,</p>
<div class="math notranslate nohighlight" id="equation-godunov-18">
<span class="eqno">(181)<a class="headerlink" href="#equation-godunov-18" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_x}^{\mac,*} &amp;=&amp; \ut_{L,\ib-\half\eb_x} - \frac{\dt}{4h}\left(w_{\ib-\eb_x+\half\eb_r}^{\trans}+w_{\ib-\eb_x-\half\eb_r}^{\trans}\right)\left(\ut_{\ib-\eb_x+\half\eb_r} - \ut_{\ib-\eb_x-\half\eb_r}\right) + \frac{\dt}{2}f_{\ut,\ib-\eb_x}, \nonumber \\
&amp;&amp; \\
\ut_{R,\ib-\half\eb_x}^{\mac,*} &amp;=&amp; \ut_{R,\ib-\half\eb_x} - \frac{\dt}{4h}\left(w_{\ib+\half\eb_r}^{\trans}+w_{\ib-\half\eb_r}^{\trans}\right)\left(\ut_{\ib+\half\eb_r} - \ut_{\ib-\half\eb_r}\right) + \frac{\dt}{2}f_{\ut,\ib}.\end{aligned}\end{split}\]</div>
<p>Solve a Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-godunov-19">
<span class="eqno">(182)<a class="headerlink" href="#equation-godunov-19" title="Link to this equation"></a></span>\[\begin{split}\ut_{\ib-\half\eb_x}^{\mac,*} =
\begin{cases}
0, &amp; \left(u_{L,\ib-\half\eb_x}^{\mac,*} \le 0 ~~ {\rm AND} ~~ u_{R,\ib-\half\eb_x}^{\mac,*} \ge 0\right) ~~ {\rm OR} ~~ \left|u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*}\right| &lt; \epsilon, \\
\ut_{L,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &gt; 0, \\
\ut_{R,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &lt; 0.
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-20">
<span class="eqno">(183)<a class="headerlink" href="#equation-godunov-20" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\wt_{L,\ib-\half\eb_x} &amp;=&amp; \wt_{\ib-\eb_x}^n + \left[\half - \frac{\dt}{2h}\max(0,u_{\ib-\eb_x}^n)\right]\Delta_x \wt_{\ib-\eb_x}^n, \\
\wt_{R,\ib-\half\eb_x} &amp;=&amp; \wt_{\ib} - \left[\half + \frac{\dt}{2h}\min(0,u_{\ib}^n)\right]\Delta_x \wt_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(u^{\trans}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-21">
<span class="eqno">(184)<a class="headerlink" href="#equation-godunov-21" title="Link to this equation"></a></span>\[\begin{split}\wt_{\ib-\half\eb_x} =
\begin{cases}
\half\left(\wt_{L,\ib-\half\eb_x} + \wt_{R,\ib-\half\eb_x}\right), &amp; \left|u^{\trans}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
\wt_{L,\ib-\half\eb_x}, &amp; u^{\trans}_{\ib-\half\eb_x} &gt; 0, \\
\wt_{R,\ib-\half\eb_x}, &amp; u^{\trans}_{\ib-\half\eb_x} &lt; 0. \\
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to r-faces using a full-dimensional extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-22">
<span class="eqno">(185)<a class="headerlink" href="#equation-godunov-22" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\wt_{L,\ib-\half\eb_r}^{\mac,*} = \wt_{L,\ib-\half\eb_r} &amp;-&amp; \frac{\dt}{4h}\left(u_{\ib-\eb_r+\half\eb_x}^{\trans}+u_{\ib-\eb_r-\half\eb_x}^{\trans}\right)\left(\wt_{\ib-\eb_r+\half\eb_x} - \wt_{\ib-\eb_r-\half\eb_x}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(\wt_{\ib-\half\eb_r}^{\trans}+\wt_{\ib-\frac{3}{2}\eb_r}^{\trans}\right)\left(w_{0,\ib-\half\eb_r} - w_{0,\ib-\frac{3}{2}\eb_r}\right) + \frac{\dt}{2}f_{\wt,\ib-\eb_r}, \nonumber \\
&amp;&amp; \\
\wt_{R,\ib-\half\eb_r}^{\mac,*} = \wt_{R,\ib-\half\eb_r} &amp;-&amp; \frac{\dt}{4h}\left(u_{\ib+\half\eb_x}^{\trans}+u_{\ib-\half\eb_x}^{\trans}\right)\left(\wt_{\ib+\half\eb_x} - \wt_{\ib-\half\eb_x}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(\wt_{\ib+\half\eb_r}^{\trans}+\wt_{\ib-\half\eb_r}^{\trans}\right)\left(w_{0,\ib+\half\eb_r} - w_{0,\ib-\half\eb_r}\right) + \frac{\dt}{2}f_{\wt,\ib}.\end{aligned}\end{split}\]</div>
<p>Solve a Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-godunov-23">
<span class="eqno">(186)<a class="headerlink" href="#equation-godunov-23" title="Link to this equation"></a></span>\[\begin{split}\wt_{\ib-\half\eb_r}^{\mac,*} =
\begin{cases}
0, &amp; \left(w_L^{\mac,*} \le 0 ~~ {\rm AND} ~~ w_R^{\mac,*} \ge 0\right) ~~ {\rm OR} ~~ \left|w_L^{\mac,*} + w_R^{\mac,*}\right| &lt; \epsilon, \\
\wt_{L,\ib-\half\eb_r}^{\mac,*}, &amp; w_L^{\mac,*} + w_R^{\mac,*} &gt; 0, \\
\wt_{R,\ib-\half\eb_r}^{\mac,*}, &amp; w_L^{\mac,*} + w_R^{\mac,*} &lt; 0.
\end{cases}\end{split}\]</div>
</section>
<section id="d-cartesian-case-3">
<span id="id3"></span><h3>3D Cartesian Case<a class="headerlink" href="#d-cartesian-case-3" title="Link to this heading"></a></h3>
<p>This algorithm is more complicated than the 2D case since we include
the effects of corner coupling.</p>
<ol class="arabic simple">
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to y-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to y-faces using a 1D extrapolation.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\ut\)</span> to y-faces by accounting for <span class="math notranslate nohighlight">\(r\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces by accounting for <span class="math notranslate nohighlight">\(y\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\vt\)</span> to x-faces by accounting for <span class="math notranslate nohighlight">\(r\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\vt\)</span> to r-faces by accounting for <span class="math notranslate nohighlight">\(x\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces by accounting for <span class="math notranslate nohighlight">\(y\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\wt\)</span> to y-faces by accounting for <span class="math notranslate nohighlight">\(x\)</span>-derivatives.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to x-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to y-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to r-faces using a full-dimensional extrapolation.</p></li>
</ol>
<ul>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to y-faces using a 1D extrapolation.</p>
<div class="math notranslate nohighlight" id="equation-godunov-24">
<span class="eqno">(187)<a class="headerlink" href="#equation-godunov-24" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_y} &amp;=&amp; \ut_{\ib-\eb_y}^n + \left[\half - \frac{\dt}{2h}\max(0,v_{\ib-\eb_y}^n)\right]\Delta_y \ut_{\ib-\eb_y}^n, \\
\ut_{R,\ib-\half\eb_y} &amp;=&amp; \ut_{\ib} - \left[\half + \frac{\dt}{2h}\min(0,v_{\ib}^n)\right]\Delta_y \ut_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(v^{\trans}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-25">
<span class="eqno">(188)<a class="headerlink" href="#equation-godunov-25" title="Link to this equation"></a></span>\[\begin{split}\ut_{\ib-\half\eb_y} =
\begin{cases}
\half\left(\ut_{L,\ib-\half\eb_y} + \ut_{R,\ib-\half\eb_y}\right), &amp; \left|v^{\trans}_{\ib-\half\eb_y}\right| &lt; \epsilon \\
\ut_{L,\ib-\half\eb_y}, &amp; v^{\trans}_{\ib-\half\eb_y} &gt; 0, \\
\ut_{R,\ib-\half\eb_y}, &amp; v^{\trans}_{\ib-\half\eb_y} &lt; 0. \\
\end{cases}\end{split}\]</div>
</li>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to y-faces using a 1D extrapolation.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\ut\)</span> to y-faces by accounting for <span class="math notranslate nohighlight">\(r\)</span>-derivatives.
The notation <span class="math notranslate nohighlight">\(\ut_{\ib-\half\eb_y}^{y|r}\)</span> means state <span class="math notranslate nohighlight">\(\ut_{\ib-\half\eb_y}\)</span> that has been updated to account for transverse derives in the r-direction.</p>
<div class="math notranslate nohighlight" id="equation-godunov-26">
<span class="eqno">(189)<a class="headerlink" href="#equation-godunov-26" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_y}^{y|r} &amp;=&amp; \ut_{L,\ib-\half\eb_y} - \frac{\dt}{6h}\left(w_{\ib-\eb_y+\half\eb_r}^{\trans}+w_{\ib-\eb_y-\half\eb_r}^{\trans}\right)\left(\ut_{\ib-\eb_y+\half\eb_r}-\ut_{\ib-\eb_y-\half\eb_r}\right), \\
\ut_{R,\ib-\half\eb_y}^{y|r} &amp;=&amp; \ut_{R,\ib-\half\eb_y} - \frac{\dt}{6h}\left(w_{\ib+\half\eb_r}^{\trans}+w_{\ib-\half\eb_r}^{\trans}\right)\left(\ut_{\ib+\half\eb_r}-\ut_{\ib-\half\eb_r}\right).\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(v^{\trans}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-27">
<span class="eqno">(190)<a class="headerlink" href="#equation-godunov-27" title="Link to this equation"></a></span>\[\begin{split}\ut_{\ib-\half\eb_y}^{y|r} =
\begin{cases}
\half\left(\ut_{L,\ib-\half\eb_y}^{y|r} + \ut_{R,\ib-\half\eb_y}^{y|r}\right), &amp; \left|v_{\ib-\half\eb_y}^{\trans}\right| &lt; \epsilon \\
\ut_{L,\ib-\half\eb_y}^{y|r}, &amp; v_{\ib-\half\eb_y}^{\trans} &gt; 0, \\
\ut_{R,\ib-\half\eb_y}^{y|r}, &amp; v_{\ib-\half\eb_y}^{\trans} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\ut\)</span> to r-faces by accounting for <span class="math notranslate nohighlight">\(y\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\vt\)</span> to x-faces by accounting for <span class="math notranslate nohighlight">\(r\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\vt\)</span> to r-faces by accounting for <span class="math notranslate nohighlight">\(x\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\wt\)</span> to x-faces by accounting for <span class="math notranslate nohighlight">\(y\)</span>-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(\wt\)</span> to y-faces by accounting for <span class="math notranslate nohighlight">\(x\)</span>-derivatives.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\ut\)</span> to x-faces using a full-dimensional extrapolation.</p>
<div class="math notranslate nohighlight" id="equation-godunov-28">
<span class="eqno">(191)<a class="headerlink" href="#equation-godunov-28" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\ut_{L,\ib-\half\eb_x}^{\mac,*} = \ut_{L,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{\trans}+v_{\ib-\eb_x-\half\eb_y}^{\trans}\right)\left(\ut_{\ib-\eb_x+\half\eb_y}^{y|r}-\ut_{\ib-\eb_x-\half\eb_y}^{y|r}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib-\eb_x+\half\eb_r}^{\trans}+w_{\ib-\eb_x-\half\eb_r}^{\trans}\right)\left(\ut_{\ib-\eb_x+\half\eb_r}^{r|y}-\ut_{\ib-\eb_x-\half\eb_r}^{r|y}\right) + \frac{\dt}{2}f_{u,\ib-\eb_x}, \nonumber \\
&amp;&amp; \\
\ut_{R,\ib-\half\eb_x}^{\mac,*} = \ut_{R,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{\trans}+v_{\ib-\half\eb_y}^{\trans}\right)\left(\ut_{\ib+\half\eb_y}^{y|r}-\ut_{\ib-\half\eb_y}^{y|r}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib+\half\eb_r}^{\trans}+w_{\ib-\half\eb_r}^{\trans}\right)\left(\ut_{\ib+\half\eb_r}^{r|y}-\ut_{\ib-\half\eb_r}^{r|y}\right) + \frac{\dt}{2}f_{u,\ib}.\end{aligned}\end{split}\]</div>
<p>Solve a Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-godunov-29">
<span class="eqno">(192)<a class="headerlink" href="#equation-godunov-29" title="Link to this equation"></a></span>\[\begin{split}\ut_{\ib-\half\eb_x}^{\mac,*} =
\begin{cases}
0, &amp; \left(u_{L,\ib-\half\eb_x}^{\mac,*} \le 0 ~~ {\rm AND} ~~ u_{R,\ib-\half\eb_x}^{\mac,*} \ge 0\right) ~~ {\rm OR} ~~ \left|u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*}\right| &lt; \epsilon, \\
\ut_{L,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &gt; 0, \\
\ut_{R,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>Predict <span class="math notranslate nohighlight">\(\vt\)</span> to y-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(\wt\)</span> to r-faces using a full-dimensional extrapolation.
In this step, make sure you account for the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span>
term before solving the Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-godunov-30">
<span class="eqno">(193)<a class="headerlink" href="#equation-godunov-30" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\wt_{L,\ib-\half\eb_r}^{\mac,*} &amp;=&amp; \wt_{L,\ib-\half\eb_r}^{\mac,*} -
\frac{\dt}{4h}\left(\wt^{\trans}_{\ib+\half\eb_r} + \wt^{\trans}_{\ib-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\
\wt_{R,\ib-\half\eb_r}^{\mac,*} &amp;=&amp; \wt_{R,\ib-\half\eb_r}^{\mac,*} -
\frac{\dt}{4h}\left(\wt^{\trans}_{\ib-\half\eb_r} + \wt^{\trans}_{\ib-\frac{3}{2}\eb_r}\right)\left(w_{0,\ib-\half\eb_r}-w_{0,\ib-\frac{3}{2}\eb_r}\right)\end{aligned}\end{split}\]</div>
</li>
</ul>
</section>
<section id="d-spherical-case-1">
<span id="id4"></span><h3>3D Spherical Case<a class="headerlink" href="#d-spherical-case-1" title="Link to this heading"></a></h3>
<p>The spherical case is the same as the plane-parallel 3D Cartesian
case, except the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term enters
in the full dimensional extrapolation for each direction.
As in the plane-parallel case, make sure to upwind using the
full velocity.</p>
</section>
</section>
<section id="computing-rho-edge-x-k-edge-rho-h-edge-and-ubt-edge-in-maestroex">
<span id="scalar-edge-state-prediction-in-maestroex"></span><h2>Computing <span class="math notranslate nohighlight">\(\rho^{'\edge}, X_k^{\edge},(\rho h)^{'\edge}\)</span>, and <span class="math notranslate nohighlight">\(\Ubt^{\edge}\)</span> in MAESTROeX<a class="headerlink" href="#computing-rho-edge-x-k-edge-rho-h-edge-and-ubt-edge-in-maestroex" title="Link to this heading"></a></h2>
<p>We call make_edge_scal to compute <span class="math notranslate nohighlight">\(\rho^{'\edge}, X_k^{\edge},
(\rho h)^{'\edge}\)</span>, and <span class="math notranslate nohighlight">\(\Ubt^{\edge}\)</span> at each edge.
The procedure is the same for each quantity, so we shall simply denote
the scalar as <span class="math notranslate nohighlight">\(s\)</span>. We always need to compute <span class="math notranslate nohighlight">\(\rho'\)</span> and <span class="math notranslate nohighlight">\(X_k\)</span> to faces,
and the choice of energy prediction is as follows:</p>
<ul class="simple">
<li><p>For enthalpy_pred_type = 1, we predict <span class="math notranslate nohighlight">\((\rho h)'\)</span> to faces.</p></li>
<li><p>For enthalpy_pred_type = 2, we predict <span class="math notranslate nohighlight">\(h\)</span> to faces.</p></li>
<li><p>For enthalpy_pred_type = 3 and 4, we predict <span class="math notranslate nohighlight">\(T\)</span> to faces.</p></li>
<li><p>For enthalpy_pred_type = 5, we predict <span class="math notranslate nohighlight">\(h'\)</span> to faces.</p></li>
<li><p>For enthalpy_pred_type = 6, we predict <span class="math notranslate nohighlight">\(T'\)</span> to faces.</p></li>
</ul>
<p>We are using enthalpy_pred_type = 1 for now. The equations
of motion are:</p>
<div class="math notranslate nohighlight" id="equation-godunov-31">
<span class="eqno">(194)<a class="headerlink" href="#equation-godunov-31" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\frac{\partial \rho'}{\partial t} &amp;=&amp; -\Ub\cdot\nabla\rho' \underbrace{- \rho'\nabla\cdot\Ub - \nabla\cdot\left(\rho_0\Ubt\right)}_{f_{\rho'}}, \\
\frac{\partial X_k}{\partial t} &amp;=&amp; -\Ub\cdot\nabla X_k ~~~ \text{(no forcing)}, \\
\frac{\partial(\rho h)'}{\partial t} &amp;=&amp; -\Ub\cdot\nabla(\rho h)' \underbrace{- (\rho h)'\nabla\cdot\Ub - \nabla\cdot\left[(\rho h)_0\Ubt\right] + \left(\Ubt\cdot\eb_r\right)\frac{\partial p_0}{\partial r} + \nabla\cdot\kth\nabla T}_{f_{(\rho h)'}}, \nonumber \\
&amp;&amp; \\
\frac{\partial\Ubt}{\partial t} &amp;=&amp; -\Ub\cdot\nabla\Ubt \underbrace{- \left(\Ubt\cdot\eb_r\right)\frac{\partial w_0}{\partial r}\eb_r \underbrace{- \frac{1}{\rho}\nabla\pi + \frac{1}{\rho_0}\frac{\partial\pi_0}{\partial r}\eb_r - \frac{(\rho-\rho_0)}{\rho}g\eb_r}_{\hbox{terms included in $\fb_{\Ubt}$}}}_{\hbox{forcing terms}}.\end{aligned}\end{split}\]</div>
<section id="d-cartesian-case-4">
<span id="id5"></span><h3>2D Cartesian Case<a class="headerlink" href="#d-cartesian-case-4" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a full-dimensional extrapolation.</p></li>
</ol>
<ul>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-32">
<span class="eqno">(195)<a class="headerlink" href="#equation-godunov-32" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_r} &amp;=&amp; s_{\ib-\eb_r}^n + \left(\half - \frac{\dt}{2h}w_{\ib-\half\eb_r}^{\mac}\right)\Delta_r s_{\ib-\eb_r}^n, \\
s_{R,\ib-\half\eb_r} &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{2h}w_{\ib-\half\eb_r}^{\mac}\right)\Delta_r s_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(w^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-33">
<span class="eqno">(196)<a class="headerlink" href="#equation-godunov-33" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_r} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_r} + s_{R,\ib-\half\eb_r}\right), &amp; \left|w^{\mac}_{\ib-\half\eb_r}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_r}, &amp; w^{\mac}_{\ib-\half\eb_r} &gt; 0, \\
s_{R,\ib-\half\eb_r}, &amp; w^{\mac}_{\ib-\half\eb_r} &lt; 0. \\
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a full-dimensional extrapolation. First, the normal derivative and forcing terms:</p>
<div class="math notranslate nohighlight" id="equation-godunov-34">
<span class="eqno">(197)<a class="headerlink" href="#equation-godunov-34" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{\ib-\eb_x}^n + \left(\half - \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib-\eb_x}^n + \frac{\dt}{2}f_{\ib-\eb_x}^n \\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{\ib}^n - \left(\half + \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib}^n + \frac{\dt}{2}f_{\ib}^n \end{aligned}\end{split}\]</div>
<p>Account for the transverse terms:</p>
<p><strong>if</strong> is_conservative <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-35">
<span class="eqno">(198)<a class="headerlink" href="#equation-godunov-35" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{2h}\left[\left(w^{\mac}s\right)_{\ib-\eb_x+\half\eb_r} - \left(w^{\mac}s\right)_{\ib-\eb_x-\half\eb_r}\right] - \frac{\dt}{2h}s_{\ib-\eb_x}^{n}\left(u_{\ib-\half\eb_x}^{\mac}-u_{\ib-\frac{3}{2}\eb_x}^{\mac}\right)\nonumber \\
&amp;&amp;\\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{2h}\left[\left(w^{\mac}s\right)_{\ib+\half\eb_r} - \left(w^{\mac}s\right)_{\ib-\half\eb_r}\right] - \frac{\dt}{2h}s_{\ib}^{n}\left(u_{\ib+\half\eb_x}^{\mac}-u_{\ib-\half\eb_x}^{\mac}\right)\end{aligned}\end{split}\]</div>
<p><strong>else</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-36">
<span class="eqno">(199)<a class="headerlink" href="#equation-godunov-36" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(w^{\mac}_{\ib-\eb_x+\half\eb_r} + w^{\mac}_{\ib-\eb_x-\half\eb_r}\right)\left(s_{\ib-\eb_x+\half\eb_r} - s_{\ib-\eb_x-\half\eb_r}\right)\\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(w^{\mac}_{\ib+\half\eb_r} + w^{\mac}_{\ib-\half\eb_r}\right)\left(s_{\ib+\half\eb_r} - s_{\ib-\half\eb_r}\right)\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Account for the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term:</p>
<p><strong>if</strong> is_vel <strong>and</strong> comp = 2 <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-37">
<span class="eqno">(200)<a class="headerlink" href="#equation-godunov-37" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib-\eb_x+\half\eb_r} + \wt^{\mac}_{\ib-\eb_x-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib+\half\eb_r} + \wt^{\mac}_{\ib-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-godunov-38">
<span class="eqno">(201)<a class="headerlink" href="#equation-godunov-38" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{\edge} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{\edge} + s_{R,\ib-\half\eb_x}^{\edge}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0.
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a 1D extrapolation:</p>
<div class="math notranslate nohighlight" id="equation-godunov-39">
<span class="eqno">(202)<a class="headerlink" href="#equation-godunov-39" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x} &amp;=&amp; s_{\ib-\eb_x}^n + \left(\half - \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib-\eb_x}^n, \\
s_{R,\ib-\half\eb_x} &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib}^n.\end{aligned}\end{split}\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-40">
<span class="eqno">(203)<a class="headerlink" href="#equation-godunov-40" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x} + s_{R,\ib-\half\eb_x}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0. \\
\end{cases}\end{split}\]</div>
<p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a full-dimensional extrapolation. First, the normal derivative and forcing terms:</p>
<div class="math notranslate nohighlight" id="equation-godunov-41">
<span class="eqno">(204)<a class="headerlink" href="#equation-godunov-41" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_r}^{\edge} &amp;=&amp;  s_{\ib-\eb_r}^n + \left(\half - \frac{\dt}{2h}w_{\ib-\half\eb_r}^{\mac}\right)\Delta_r s_{\ib-\eb_r}^n + \frac{\dt}{2}f_{\ib-\eb_r}^n \\
s_{R,\ib-\half\eb_r}^{\edge} &amp;=&amp;  s_{\ib}^n - \left(\half + \frac{\dt}{2h}w_{\ib-\half\eb_r}^{\mac}\right)\Delta_r s_{\ib}^n + \frac{\dt}{2}f_{\ib}^n \end{aligned}\end{split}\]</div>
<p>Account for the transverse terms:
<strong>if</strong> is_conservative <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-42">
<span class="eqno">(205)<a class="headerlink" href="#equation-godunov-42" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{2h}\left[\left(u^{\mac}s\right)_{\ib-\eb_r+\half\eb_x} - \left(u^{\mac}s\right)_{\ib-\eb_r-\half\eb_x}\right] - \frac{\dt}{2h}s_{\ib-\eb_r}^{n}\left(w_{\ib-\half\eb_r}^{\mac}-w_{\ib-\frac{3}{2}\eb_r}^{\mac}\right)\nonumber\\
&amp;&amp; \\
s_{R,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{2h}\left[\left(u^{\mac}s\right)_{\ib+\half\eb_x} - \left(u^{\mac}s\right)_{\ib-\half\eb_x}\right] - \frac{\dt}{2h}s_{\ib}^{n}\left(w_{\ib+\half\eb_r}^{\mac}-w_{\ib-\half\eb_r}^{\mac}\right)\end{aligned}\end{split}\]</div>
<p><strong>else</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-43">
<span class="eqno">(206)<a class="headerlink" href="#equation-godunov-43" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{4h}\left(u^{\mac}_{\ib-\eb_r+\half\eb_x} + u^{\mac}_{\ib-\eb_r-\half\eb_x}\right)\left(s_{\ib-\eb_r+\half\eb_x} - s_{\ib-\eb_r-\half\eb_x}\right)\\
s_{R,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{4h}\left(u^{\mac}_{\ib+\half\eb_x} + u^{\mac}_{\ib-\half\eb_x}\right)\left(s_{\ib+\half\eb_x} - s_{\ib-\half\eb_x}\right)\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Account for the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term:
<strong>if</strong> is_vel <strong>and</strong> comp = 2 <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-44">
<span class="eqno">(207)<a class="headerlink" href="#equation-godunov-44" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib-\half\eb_r} + \wt^{\mac}_{\ib-\frac{3}{2}\eb_r}\right)\left(w_{0,\ib-\half\eb_r}-w_{0,\ib-\frac{3}{2}\eb_r}\right) \\
s_{R,\ib-\half\eb_r}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_r}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib+\half\eb_r} + \wt^{\mac}_{\ib-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Upwind based on <span class="math notranslate nohighlight">\(w^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-45">
<span class="eqno">(208)<a class="headerlink" href="#equation-godunov-45" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_r} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_r} + s_{R,\ib-\half\eb_r}\right), &amp; \left|w^{\mac}_{\ib-\half\eb_r}\right| &lt; \epsilon \\
u_{L,\ib-\half\eb_r}, &amp; w^{\mac}_{\ib-\half\eb_r} &gt; 0, \\
u_{R,\ib-\half\eb_r}, &amp; w^{\mac}_{\ib-\half\eb_r} &lt; 0. \\
\end{cases}\end{split}\]</div>
</li>
</ul>
</section>
<section id="d-cartesian-case-5">
<span id="id6"></span><h3>3D Cartesian Case<a class="headerlink" href="#d-cartesian-case-5" title="Link to this heading"></a></h3>
<p>This algorithm is more complicated than the 2D case since we include
the effects of corner coupling.</p>
<ol class="arabic simple">
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to y-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to x-faces by accounting for y-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to x-faces by accounting for r-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to y-faces by accounting for x-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to y-faces by accounting for r-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to r-faces by accounting for x-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to r-faces by accounting for y-derivatives.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to y-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a full-dimensional extrapolation.</p></li>
</ol>
<ul>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a 1D extrapolation.</p>
<div class="math notranslate nohighlight" id="equation-3d-predict-s-to-left">
<span class="eqno">(209)<a class="headerlink" href="#equation-3d-predict-s-to-left" title="Link to this equation"></a></span>\[s_{L,\ib-\half\eb_x} &amp;=&amp; s_{\ib-\eb_x}^n + \left(\half - \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib-\eb_x}^n,\]</div>
<div class="math notranslate nohighlight" id="equation-3d-predict-s-to-right">
<span class="eqno">(210)<a class="headerlink" href="#equation-3d-predict-s-to-right" title="Link to this equation"></a></span>\[s_{R,\ib-\half\eb_x} &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib}^n.\]</div>
<p>Upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-46">
<span class="eqno">(211)<a class="headerlink" href="#equation-godunov-46" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x} + s_{R,\ib-\half\eb_x}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0. \\
\end{cases}\end{split}\]</div>
</li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to y-faces using a 1D extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a 1D extrapolation.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to x-faces by accounting for y-derivatives.
The notation <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}^{x|y}\)</span> means “state <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}\)</span>
that has been updated to account for the transverse derivatives in
the <span class="math notranslate nohighlight">\(y\)</span>-direction”.</p>
<p><strong>if</strong> is_conservative <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-47">
<span class="eqno">(212)<a class="headerlink" href="#equation-godunov-47" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{L,\ib-\half\eb_x} - \frac{\dt}{3h}\left[(sv^{\mac})_{\ib-\eb_x+\half\eb_y}-(sv^{\mac})_{\ib-\eb_x-\half\eb_y}\right], \\
s_{R,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{R,\ib-\half\eb_x} - \frac{\dt}{3h}\left[(sv^{\mac})_{\ib+\half\eb_y}-(sv^{\mac})_{\ib-\half\eb_y}\right].\end{aligned}\end{split}\]</div>
<p><strong>else</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-48">
<span class="eqno">(213)<a class="headerlink" href="#equation-godunov-48" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{L,\ib-\half\eb_x} - \frac{\dt}{6h}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac} + v_{\ib-\eb_x-\half\eb_y}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_y} - s_{\ib-\eb_x-\half\eb_y}\right), \\
s_{R,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{R,\ib-\half\eb_x} - \frac{\dt}{6h}\left(v_{\ib+\half\eb_y}^{\mac} + v_{\ib-\half\eb_y}^{\mac}\right)\left(s_{\ib+\half\eb_y} - s_{\ib-\half\eb_y}\right).\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-49">
<span class="eqno">(214)<a class="headerlink" href="#equation-godunov-49" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{x|y} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{x|y} + s_{R,\ib-\half\eb_x}^{x|y}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{x|y}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{x|y}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to x-faces by accounting for r-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to y-faces by accounting for x-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to y-faces by accounting for r-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to r-faces by accounting for x-derivatives.</p></li>
<li><p>Update prediction of <span class="math notranslate nohighlight">\(s\)</span> to r-faces by accounting for y-derivatives.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to x-faces using a full-dimensional extrapolation.</p>
<p><strong>if</strong> is_conservative <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-50">
<span class="eqno">(215)<a class="headerlink" href="#equation-godunov-50" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} = s_{L,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{2h}\left[(s^{y|r}v^{\mac})_{\ib-\eb_x+\half\eb_y}-({s^{y|r}v^{\mac})_{\ib-\eb_x-\half\eb_y}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}\left[(s^{r|y}w^{\mac})_{\ib-\eb_x+\half\eb_r}-({s^{r|y}w^{\mac})_{\ib-\eb_x-\half\eb_r}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}s_{\ib-\eb_x}\left(u_{\ib-\half\eb_x}^{\mac}-u_{\ib-\frac{3}{2}\eb_x}^{\mac}\right) + \frac{\dt}{2}f_{\ib-\eb_x}, \\
s_{R,\ib-\half\eb_x}^{\edge} = s_{R,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{2h}\left[(s^{y|r}v^{\mac})_{\ib+\half\eb_y}-({s^{y|r}v^{\mac})_{\ib-\half\eb_y}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}\left[(s^{r|y}w^{\mac})_{\ib+\half\eb_r}-({s^{r|y}w^{\mac})_{\ib-\half\eb_r}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}s_{\ib}\left(u_{\ib+\half\eb_x}^{\mac}-u_{\ib-\half\eb_x}^{\mac}\right) + \frac{\dt}{2}f_{\ib}.\end{aligned}\end{split}\]</div>
<p><strong>else</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-51">
<span class="eqno">(216)<a class="headerlink" href="#equation-godunov-51" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} = s_{L,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac}+v_{\ib-\eb_x-\half\eb_y}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_y}^{y|r}-s_{\ib-\eb_x-\half\eb_y}^{y|r}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib-\eb_x+\half\eb_r}^{\mac}+w_{\ib-\eb_x-\half\eb_r}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_r}^{r|y}-s_{\ib-\eb_x-\half\eb_r}^{r|y}\right) + \frac{\dt}{2}f_{\ib-\eb_x}, \nonumber \\
&amp;&amp; \\
s_{R,\ib-\half\eb_x}^{\edge} = s_{R,\ib-\half\eb_x} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{\mac}+v_{\ib-\half\eb_y}^{\mac}\right)\left(s_{\ib+\half\eb_y}^{y|r}-s_{\ib-\half\eb_y}^{y|r}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib+\half\eb_r}^{\mac}+w_{\ib-\half\eb_r}^{\mac}\right)\left(s_{\ib+\half\eb_r}^{r|y}-s_{\ib-\half\eb_r}^{r|y}\right) + \frac{\dt}{2}f_{\ib}.\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Account for the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term:</p>
<p><strong>if</strong> is_vel <strong>and</strong> comp = 2 <strong>then</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-52">
<span class="eqno">(217)<a class="headerlink" href="#equation-godunov-52" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib-\eb_x+\half\eb_r} + \wt^{\mac}_{\ib-\eb_x-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_x}^{\edge} -
\frac{\dt}{4h}\left(\wt^{\mac}_{\ib+\half\eb_r} + \wt^{\mac}_{\ib-\half\eb_r}\right)\left(w_{0,\ib+\half\eb_r}-w_{0,\ib-\half\eb_r}\right) \\\end{aligned}\end{split}\]</div>
<p><strong>end if</strong></p>
</li>
<li><p>Upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-53">
<span class="eqno">(218)<a class="headerlink" href="#equation-godunov-53" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{\edge} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{\edge} + s_{R,\ib-\half\eb_x}^{\edge}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to y-faces using a full-dimensional extrapolation.</p></li>
<li><p>Predict <span class="math notranslate nohighlight">\(s\)</span> to r-faces using a full-dimensional extrapolation.</p></li>
</ul>
</section>
<section id="d-spherical-case-2">
<span id="id7"></span><h3>3D Spherical Case<a class="headerlink" href="#d-spherical-case-2" title="Link to this heading"></a></h3>
<p>The spherical case is the same as the plane-parallel 3D Cartesian
case, except the <span class="math notranslate nohighlight">\(\partial w_0/\partial r\)</span> term enters in the full
dimensional extrapolation for each direction when predicting velocity
to faces. As in the plane-parallel case, make sure upwind based on
the full velocity.</p>
</section>
</section>
<section id="computing-ub-mac-in-varden">
<h2>Computing <span class="math notranslate nohighlight">\(\Ub^{\mac,*}\)</span> in VARDEN<a class="headerlink" href="#computing-ub-mac-in-varden" title="Link to this heading"></a></h2>
<section id="d-cartesian-case-6">
<span id="id8"></span><h3>2D Cartesian Case<a class="headerlink" href="#d-cartesian-case-6" title="Link to this heading"></a></h3>
<ul>
<li><p>We do a 1D Taylor series extrapolation to get both components of velocity at the x-face:</p>
<div class="math notranslate nohighlight" id="equation-varden-u-l-1d">
<span class="eqno">(219)<a class="headerlink" href="#equation-varden-u-l-1d" title="Link to this equation"></a></span>\[u_{L,\ib-\half\eb_x}^{1D} = u_{\ib-\eb_x} + \left[\half - \frac{\dt}{2h}{\rm max}(0,u_{\ib-\eb_x})\right]\Delta_xu_{\ib-\eb_x},\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-54">
<span class="eqno">(220)<a class="headerlink" href="#equation-godunov-54" title="Link to this equation"></a></span>\[u_{R,\ib-\half\eb_x}^{1D} = u_{\ib} + \left[\half - \frac{\dt}{2h}{\rm min}(0,u_{\ib})\right]\Delta_xu_{\ib} .\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-55">
<span class="eqno">(221)<a class="headerlink" href="#equation-godunov-55" title="Link to this equation"></a></span>\[v_{L,\ib-\half\eb_x}^{1D} = v_{\ib-\eb_x} + \left[\half - \frac{\dt}{2h}{\rm max}(0,v_{\ib-\eb_x})\right]\Delta_xv_{\ib-\eb_x},\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-56">
<span class="eqno">(222)<a class="headerlink" href="#equation-godunov-56" title="Link to this equation"></a></span>\[v_{R,\ib-\half\eb_x}^{1D} &amp;=&amp; v_{\ib} + \left[\half - \frac{\dt}{2h}{\rm min}(0,v_{\ib})\right]\Delta_xv_{\ib}.\]</div>
<p>We obtain the normal velocity using the Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-godunov-57">
<span class="eqno">(223)<a class="headerlink" href="#equation-godunov-57" title="Link to this equation"></a></span>\[\begin{split}u_{\ib-\half\eb_x}^{1D} =
\begin{cases}
0, &amp; \left(u_{L,\ib-\half\eb_x}^{1D} \le 0 ~~ {\rm AND} ~~ u_{R,\ib-\half\eb_x}^{1D} \ge 0\right) ~~ {\rm OR} ~~ \left|u_{L,\ib-\half\eb_x}^{1D} + u_{R,\ib-\half\eb_x}^{1D}\right| &lt; \epsilon, \\
u_{L,\ib-\half\eb_x}^{1D}, &amp; u_{L,\ib-\half\eb_x}^{1D} + u_{R,\ib-\half\eb_x}^{1D} &gt; 0, \\
u_{R,\ib-\half\eb_x}^{1D}, &amp; u_{L,\ib-\half\eb_x}^{1D} + u_{R,\ib-\half\eb_x}^{1D} &lt; 0.
\end{cases}\end{split}\]</div>
<p>We obtain the transverse velocity by upwinding based on
<span class="math notranslate nohighlight">\(u_{\ib-\half\eb_x}^{1D}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-transverse-velocity-riemann-problem">
<span class="eqno">(224)<a class="headerlink" href="#equation-transverse-velocity-riemann-problem" title="Link to this equation"></a></span>\[\begin{split}v_{\ib-\half\eb_x}^{1D} =
\begin{cases}
\half\left(v_{L,\ib-\half\eb_x}^{1D} + v_{R,\ib-\half\eb_x}^{1D}\right), &amp; \left|u_{\ib-\half\eb_x}^{1D}\right| &lt; \epsilon \\
v_{L,\ib-\half\eb_x}^{1D}, &amp; u_{\ib-\half\eb_x}^{1D} &gt; 0, \\
v_{R,\ib-\half\eb_x}^{1D}, &amp; u_{\ib-\half\eb_x}^{1D} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>We perform analogous operations to compute both components of velocity
at the y-faces, <span class="math notranslate nohighlight">\(\Ub_{\ib-\half\eb_y}^{1D}\)</span>.</p></li>
<li><p>Now we do a full-dimensional extrapolation to get the MAC velocity at
the x-faces (note that we only compute the normal components):</p>
<div class="math notranslate nohighlight" id="equation-godunov-58">
<span class="eqno">(225)<a class="headerlink" href="#equation-godunov-58" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
u_{L,\ib-\half\eb_x}^{\mac,*} &amp;=&amp; u_{L,\ib-\half\eb_x}^{1D} - \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{1D}+v_{\ib-\eb_x-\half\eb_y}^{1D}\right)\left(u_{\ib-\eb_x+\half\eb_y}^{1D} - u_{\ib-\eb_x-\half\eb_y}^{1D}\right) + \frac{\dt}{2}f_{u,\ib-\eb_x}, \\
u_{R,\ib-\half\eb_x}^{\mac,*} &amp;=&amp; u_{R,\ib-\half\eb_x}^{1D} - \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{1D}+v_{\ib-\half\eb_y}^{1D}\right)\left(u_{\ib+\half\eb_y}^{1D} - u_{\ib-\half\eb_y}^{1D}\right) + \frac{\dt}{2}f_{u,\ib}.\end{aligned}\end{split}\]</div>
<p>Then we solve a Riemann problem:</p>
<div class="math notranslate nohighlight" id="equation-umac-riemann-problem">
<span class="eqno">(226)<a class="headerlink" href="#equation-umac-riemann-problem" title="Link to this equation"></a></span>\[\begin{split}u_{\ib-\half\eb_x}^{\mac,*} =
\begin{cases}
0, &amp; \left(u_{L,\ib-\half\eb_x}^{\mac,*} \le 0 ~~ {\rm AND} ~~ u_{R,\ib-\half\eb_x}^{\mac,*} \ge 0\right) ~~ {\rm OR} ~~ \left|u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*}\right| &lt; \epsilon, \\
u_{L,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &gt; 0, \\
u_{R,\ib-\half\eb_x}^{\mac,*}, &amp; u_{L,\ib-\half\eb_x}^{\mac,*} + u_{R,\ib-\half\eb_x}^{\mac,*} &lt; 0.
\end{cases}\end{split}\]</div>
</li>
<li><p>We perform analogous operations to compute the normal velocity at the
y-faces, <span class="math notranslate nohighlight">\(v^{\mac,*}_{\ib-\half\eb_y}\)</span>.</p></li>
</ul>
</section>
<section id="d-cartesian-case-7">
<span id="id9"></span><h3>3D Cartesian Case<a class="headerlink" href="#d-cartesian-case-7" title="Link to this heading"></a></h3>
<p>This is more complicated than the 2D case because we include corner
coupling. We compute <span class="math notranslate nohighlight">\(\Ub_{\ib-\half\eb_x}^{1D},
\Ub_{\ib-\half\eb_y}^{1D}\)</span>, and <span class="math notranslate nohighlight">\(\Ub_{\ib-\half\eb_z}^{1D}\)</span> in
an analogous manner as <code class="xref eq docutils literal notranslate"><span class="pre">varden</span> <span class="pre">U_L^1D]</span></code>-<a class="reference internal" href="#equation-transverse-velocity-riemann-problem">Eq.224</a>. Then we compute an intermediate state,
<span class="math notranslate nohighlight">\(u_{\ib-\half\eb_y}^{y|z}\)</span>, which is described as “state
<span class="math notranslate nohighlight">\(u_{\ib-\half\eb_y}^{1D}\)</span> that has been updated to account for
the transverse derivatives in the z direction”, using:</p>
<div class="math notranslate nohighlight" id="equation-godunov-59">
<span class="eqno">(227)<a class="headerlink" href="#equation-godunov-59" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
u_{L,\ib-\half\eb_y}^{y|z} &amp;=&amp; u_{L,\ib-\half\eb_y}^{1D} - \frac{\dt}{6h}\left(w_{\ib-\eb_y+\half\eb_z}^{1D}+w_{\ib-\eb_y-\half\eb_z}^{1D}\right)\left(u_{\ib-\eb_y+\half\eb_z}^{1D}-u_{\ib-\eb_y-\half\eb_z}^{1D}\right), \\
u_{R,\ib-\half\eb_y}^{y|z} &amp;=&amp; u_{R,\ib-\half\eb_y}^{1D} - \frac{\dt}{6h}\left(w_{\ib+\half\eb_z}^{1D}+w_{\ib-\half\eb_z}^{1D}\right)\left(u_{\ib+\half\eb_z}^{1D}-u_{\ib-\half\eb_z}^{1D}\right).\end{aligned}\end{split}\]</div>
<p>Then upwind based on <span class="math notranslate nohighlight">\(v_{\ib-\half\eb_y}^{1D}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-60">
<span class="eqno">(228)<a class="headerlink" href="#equation-godunov-60" title="Link to this equation"></a></span>\[\begin{split}u_{\ib-\half\eb_y}^{y|z} =
\begin{cases}
\half\left(u_{L,\ib-\half\eb_y}^{y|z} + u_{R,\ib-\half\eb_y}^{y|z}\right), &amp; \left|v_{\ib-\half\eb_y}^{1D}\right| &lt; \epsilon \\
u_{L,\ib-\half\eb_y}^{y|z}, &amp; v_{\ib-\half\eb_y}^{1D} &gt; 0, \\
u_{R,\ib-\half\eb_y}^{y|z}, &amp; v_{\ib-\half\eb_y}^{1D} &lt; 0.
\end{cases}\end{split}\]</div>
<p>We use an analogous procedure to compute five more intermediate states,
<span class="math notranslate nohighlight">\(u_{\ib-\half\eb_z}^{z|y}, v_{\ib-\half\eb_x}^{x|z},
v_{\ib-\half\eb_z}^{z|x}, w_{\ib-\half\eb_x}^{x|y}\)</span>, and
<span class="math notranslate nohighlight">\(w_{\ib-\half\eb_y}^{y|x}\)</span>. Then we do a full-dimensional
extrapolation to get the MAC velocities at normal faces:</p>
<div class="math notranslate nohighlight" id="equation-godunov-61">
<span class="eqno">(229)<a class="headerlink" href="#equation-godunov-61" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
u_{L,\ib-\half\eb_x}^{\mac,*} = u_{L,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{1D}+v_{\ib-\eb_x-\half\eb_y}^{1D}\right)\left(u_{\ib-\eb_x+\half\eb_y}^{y|z}-u_{\ib-\eb_x-\half\eb_y}^{y|z}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib-\eb_x+\half\eb_z}^{1D}+w_{\ib-\eb_x-\half\eb_z}^{1D}\right)\left(u_{\ib-\eb_x+\half\eb_z}^{z|y}-u_{\ib-\eb_x-\half\eb_z}^{z|y}\right) + \frac{\dt}{2}f_{u,\ib-\eb_x}, \\
u_{R,\ib-\half\eb_x}^{\mac,*} = u_{R,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{1D}+v_{\ib-\half\eb_y}^{1D}\right)\left(u_{\ib+\half\eb_y}^{y|z}-u_{\ib-\half\eb_y}^{y|z}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib+\half\eb_z}^{1D}+w_{\ib-\half\eb_z}^{1D}\right)\left(u_{\ib+\half\eb_z}^{z|y}-u_{\ib-\half\eb_z}^{z|y}\right) + \frac{\dt}{2}f_{u,\ib}.\end{aligned}\end{split}\]</div>
<p>Then we use the Riemann solver given above for the 2D case (<a class="reference internal" href="#equation-umac-riemann-problem">Eq.226</a>) to compute
<span class="math notranslate nohighlight">\(u_{\ib-\half\eb_x}^{\mac,*}\)</span>. We use an analogous procedure to
obtain <span class="math notranslate nohighlight">\(v_{\ib-\half\eb_y}^{\mac,*}\)</span> and
<span class="math notranslate nohighlight">\(w_{\ib-\half\eb_z}^{\mac,*}\)</span>.</p>
</section>
</section>
<section id="computing-ub-edge-and-rho-edge-in-varden">
<h2>Computing <span class="math notranslate nohighlight">\(\Ub^{\edge}\)</span> and <span class="math notranslate nohighlight">\(\rho^{\edge}\)</span> in VARDEN<a class="headerlink" href="#computing-ub-edge-and-rho-edge-in-varden" title="Link to this heading"></a></h2>
<p>To compute <span class="math notranslate nohighlight">\(\Ub^{\edge}\)</span>, VARDEN uses the exact same algorithm
as the <span class="math notranslate nohighlight">\(s^{\edge}\)</span> case in MAESTROeX. The algorithm for
<span class="math notranslate nohighlight">\(\rho^{\edge}\)</span> in VARDEN is slightly different than the
<span class="math notranslate nohighlight">\(s^{\edge}\)</span> case in MAESTROeX since it uses a “conservative”
formulation. Here, <span class="math notranslate nohighlight">\(s\)</span> is used in place of either <span class="math notranslate nohighlight">\(\rho, u, v\)</span>, or
<span class="math notranslate nohighlight">\(w\)</span> (in 3D).</p>
<section id="d-cartesian-case-8">
<span id="id10"></span><h3>2D Cartesian Case<a class="headerlink" href="#d-cartesian-case-8" title="Link to this heading"></a></h3>
<p>The 1D extrapolation is:</p>
<div class="math notranslate nohighlight" id="equation-varden-s-l-1d">
<span class="eqno">(230)<a class="headerlink" href="#equation-varden-s-l-1d" title="Link to this equation"></a></span>\[s_{L,\ib-\half\eb_x}^{1D} = s_{\ib-\eb_x}^n + \left(\half - \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib-\eb_x}^n,\]</div>
<div class="math notranslate nohighlight" id="equation-varden-s-r-1d">
<span class="eqno">(231)<a class="headerlink" href="#equation-varden-s-r-1d" title="Link to this equation"></a></span>\[s_{R,\ib-\half\eb_x}^{1D} = s_{\ib} - \left(\half + \frac{\dt}{2h}u_{\ib-\half\eb_x}^{\mac}\right)\Delta_x s_{\ib}^n.\]</div>
<p>Then we upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-62">
<span class="eqno">(232)<a class="headerlink" href="#equation-godunov-62" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{1D} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{1D} + s_{R,\ib-\half\eb_x}^{1D}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{1D}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{1D}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0. \\
\end{cases}\end{split}\]</div>
<p>We use an analogous procedure to obtain <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_y}^{1D}\)</span>.
Now we do a full-dimensional extrapolation of <span class="math notranslate nohighlight">\(s\)</span> to each face. The
extrapolation of a “non-conserved” <span class="math notranslate nohighlight">\(s\)</span> to x-faces is:</p>
<div class="math notranslate nohighlight" id="equation-godunov-63">
<span class="eqno">(233)<a class="headerlink" href="#equation-godunov-63" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{L,\ib-\half\eb_x}^{1D} - \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac}+v_{\ib-\eb_x-\half\eb_y}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_y}^{1D} - s_{\ib-\eb_x-\half\eb_y}^{1D}\right) + \frac{\dt}{2}f_{s,\ib-\eb_x}, \\
s_{R,\ib-\half\eb_x}^{\edge} &amp;=&amp; s_{R,\ib-\half\eb_x}^{1D} - \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{\mac}+v_{\ib-\half\eb_y}^{\mac}\right)\left(s_{\ib+\half\eb_y}^{1D} - s_{\ib-\half\eb_y}^{1D}\right) + \frac{\dt}{2}f_{s,\ib}.\end{aligned}\end{split}\]</div>
<p>The extrapolation of a “conserved” <span class="math notranslate nohighlight">\(s\)</span> to x-faces is:</p>
<div class="math notranslate nohighlight" id="equation-godunov-64">
<span class="eqno">(234)<a class="headerlink" href="#equation-godunov-64" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} = s_{L,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{2h}\left[(s^{1D} v^{\mac})_{\ib-\eb_x+\half\eb_y} - (s^{1D} v^{\mac})_{\ib-\eb_x-\half\eb_y}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2}s_{\ib-\eb_x}(\nabla\cdot\Ub^{\mac})_{\ib-\eb_x} + \frac{\dt}{2h}s_{\ib-\eb_x}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac} - v_{\ib-\eb_x-\half\eb_y}^{\mac}\right) + \frac{\dt}{2}f_{s,\ib-\eb_x}, \\
s_{R,\ib-\half\eb_x}^{\edge} = s_{R,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{2h}\left[(s^{1D} v^{\mac})_{\ib+\half\eb_y} - (s^{1D} v^{\mac})_{\ib-\half\eb_y}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2}s_{\ib}(\nabla\cdot\Ub^{\mac})_{\ib} + \frac{\dt}{2h}s_{\ib}\left(v_{\ib+\half\eb_y}^{\mac} - v_{\ib-\half\eb_y}^{\mac}\right) + \frac{\dt}{2}f_{s,\ib}.\end{aligned}\end{split}\]</div>
<p>Then we upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-varden-s-edge-upwind">
<span class="eqno">(235)<a class="headerlink" href="#equation-varden-s-edge-upwind" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{\edge} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{\edge} + s_{R,\ib-\half\eb_x}^{\edge}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{\edge}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0.
\end{cases}\end{split}\]</div>
<p>We use an analogous procedure to compute <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_y}^{\edge}\)</span>.</p>
</section>
<section id="d-cartesian-case-9">
<span id="id11"></span><h3>3D Cartesian Case<a class="headerlink" href="#d-cartesian-case-9" title="Link to this heading"></a></h3>
<p>This is more complicated than the 2D case because we include corner
coupling. We first compute <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}^{1D}\)</span>,
<span class="math notranslate nohighlight">\(s_{\ib-\half\eb_y}^{1D}\)</span>, and <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_z}^{1D}\)</span> in an
analogous manner to <a class="reference internal" href="#equation-varden-s-l-1d">Eq.230</a> and <a class="reference internal" href="#equation-varden-s-r-1d">Eq.231</a>. Then we compute six intermediate states,
<span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}^{x|y}, s_{\ib-\half\eb_x}^{x|z},
s_{\ib-\half\eb_y}^{y|x}, s_{\ib-\half\eb_y}^{y|z},
s_{\ib-\half\eb_z}^{z|x}\)</span>, and <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_z}^{z|y}\)</span>. For the
“non-conservative case”, we use, for example:</p>
<div class="math notranslate nohighlight" id="equation-godunov-65">
<span class="eqno">(236)<a class="headerlink" href="#equation-godunov-65" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{L,\ib-\half\eb_x}^{1D} - \frac{\dt}{6h}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac} + v_{\ib-\eb_x-\half\eb_y}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_y}^{1D} - s_{\ib-\eb_x-\half\eb_y}^{1D}\right), \\
s_{R,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{R,\ib-\half\eb_x}^{1D} - \frac{\dt}{6h}\left(v_{\ib+\half\eb_y}^{\mac} + v_{\ib-\half\eb_y}^{\mac}\right)\left(s_{\ib+\half\eb_y}^{1D} - s_{\ib-\half\eb_y}^{1D}\right).\end{aligned}\end{split}\]</div>
<p>For the “conservative” case, we use, for example:</p>
<div class="math notranslate nohighlight" id="equation-godunov-66">
<span class="eqno">(237)<a class="headerlink" href="#equation-godunov-66" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{L,\ib-\half\eb_x}^{1D} - \frac{\dt}{3h}\left[(sv^{\mac})_{\ib-\eb_x+\half\eb_y}-(sv^{\mac})_{\ib-\eb_x-\half\eb_y}\right], \\
s_{R,\ib-\half\eb_x}^{x|y} &amp;=&amp; s_{R,\ib-\half\eb_x}^{1D} - \frac{\dt}{3h}\left[(sv^{\mac})_{\ib+\half\eb_y}-(sv^{\mac})_{\ib-\half\eb_y}\right].\end{aligned}\end{split}\]</div>
<p>Then we upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-67">
<span class="eqno">(238)<a class="headerlink" href="#equation-godunov-67" title="Link to this equation"></a></span>\[\begin{split}s_{\ib-\half\eb_x}^{x|y} =
\begin{cases}
\half\left(s_{L,\ib-\half\eb_x}^{x|y} + s_{R,\ib-\half\eb_x}^{x|y}\right), &amp; \left|u^{\mac}_{\ib-\half\eb_x}\right| &lt; \epsilon \\
s_{L,\ib-\half\eb_x}^{x|y}, &amp; u^{\mac}_{\ib-\half\eb_x} &gt; 0, \\
s_{R,\ib-\half\eb_x}^{x|y}, &amp; u^{\mac}_{\ib-\half\eb_x} &lt; 0.
\end{cases}\end{split}\]</div>
<p>We use an analogous procedure to compute the other five intermediate
states. Now we do a full-dimensional extrapolation of <span class="math notranslate nohighlight">\(s\)</span> to each
face. The extrapolation of a “non-conserved” <span class="math notranslate nohighlight">\(s\)</span> to x-faces is:</p>
<div class="math notranslate nohighlight" id="equation-godunov-68">
<span class="eqno">(239)<a class="headerlink" href="#equation-godunov-68" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} = s_{L,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac}+v_{\ib-\eb_x-\half\eb_y}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_y}^{y|z}-s_{\ib-\eb_x-\half\eb_y}^{y|z}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib-\eb_x+\half\eb_z}^{\mac}+w_{\ib-\eb_x-\half\eb_z}^{\mac}\right)\left(s_{\ib-\eb_x+\half\eb_z}^{z|y}-s_{\ib-\eb_x-\half\eb_z}^{z|y}\right) \nonumber \\
&amp;+&amp; \frac{\dt}{2}f_{s,\ib-\eb_x}, \\
s_{R,\ib-\half\eb_x}^{\edge} = s_{R,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{4h}\left(v_{\ib+\half\eb_y}^{\mac}+v_{\ib-\half\eb_y}^{\mac}\right)\left(s_{\ib+\half\eb_y}^{y|z}-s_{\ib-\half\eb_y}^{y|z}\right) \nonumber \\
&amp;-&amp; \frac{\dt}{4h}\left(w_{\ib+\half\eb_z}^{\mac}+w_{\ib-\half\eb_z}^{\mac}\right)\left(s_{\ib+\half\eb_z}^{z|y}-s_{\ib-\half\eb_z}^{z|y}\right) \nonumber \\
&amp;+&amp; \frac{\dt}{2}f_{s,\ib}.\end{aligned}\end{split}\]</div>
<p>The extrapolation of a “conserved” <span class="math notranslate nohighlight">\(s\)</span> to x-faces is:</p>
<div class="math notranslate nohighlight" id="equation-godunov-69">
<span class="eqno">(240)<a class="headerlink" href="#equation-godunov-69" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,\ib-\half\eb_x}^{\edge} = s_{L,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{2h}\left[(s^{y|z}v^{\mac})_{\ib-\eb_x+\half\eb_y}-({s^{y|z}v^{\mac})_{\ib-\eb_x-\half\eb_y}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}\left[(s^{z|y}w^{\mac})_{\ib-\eb_x+\half\eb_z}-({s^{z|y}w^{\mac})_{\ib-\eb_x-\half\eb_z}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2}s_{\ib-\eb_x}(\nabla\cdot\Ub^{\mac})_{\ib-\eb_x} \nonumber \\
&amp;+&amp; \frac{\dt}{2h}s_{\ib-\eb_x}\left(v_{\ib-\eb_x+\half\eb_y}^{\mac}-v_{\ib-\eb_x-\half\eb_y}^{\mac}+w_{\ib-\eb_x+\half\eb_z}^{\mac}-w_{\ib-\eb_x-\half\eb_z}^{\mac}\right) \nonumber \\
&amp;+&amp; \frac{\dt}{2}f_{s,\ib-\eb_x}, \\
s_{R,\ib-\half\eb_x}^{\edge} = s_{R,\ib-\half\eb_x}^{1D} &amp;-&amp; \frac{\dt}{2h}\left[(s^{y|z}v^{\mac})_{\ib+\half\eb_y}-({s^{y|z}v^{\mac})_{\ib-\half\eb_y}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2h}\left[(s^{z|y}w^{\mac})_{\ib+\half\eb_z}-({s^{z|y}w^{\mac})_{\ib-\half\eb_z}}\right] \nonumber \\
&amp;-&amp; \frac{\dt}{2}s_{\ib}(\nabla\cdot\Ub^{\mac})_{\ib} \nonumber \\
&amp;+&amp; \frac{\dt}{2h}s_{\ib}\left(v_{\ib+\half\eb_y}^{\mac}-v_{\ib-\half\eb_y}^{\mac}+w_{\ib+\half\eb_z}^{\mac}-w_{\ib-\half\eb_z}^{\mac}\right) \nonumber \\
&amp;+&amp; \frac{\dt}{2}f_{s,\ib}.\end{aligned}\end{split}\]</div>
<p>Then we upwind based on <span class="math notranslate nohighlight">\(u^{\mac}\)</span>, as in <a class="reference internal" href="#equation-varden-s-edge-upwind">Eq.235</a>.
We use an analogous procedure to compute both
<span class="math notranslate nohighlight">\(s_{\ib-\half\eb_y}^{\edge}\)</span> and <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_z}\)</span>.</p>
</section>
</section>
<section id="estate-fpu-in-godunov-2d-3d-f">
<h2>ESTATE_FPU in GODUNOV_2D/3D.f<a class="headerlink" href="#estate-fpu-in-godunov-2d-3d-f" title="Link to this heading"></a></h2>
<ul>
<li><p>First, the normal predictor.</p>
<div class="math notranslate nohighlight" id="equation-godunov-70">
<span class="eqno">(241)<a class="headerlink" href="#equation-godunov-70" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_L^x &amp;=&amp; s_{\ib-\eb_x} + \left(\half - \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib-\eb_x} + \underbrace{\frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x}}_{\text{IF USE\_MINION}} \\
s_R^x &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \underbrace{\frac{\dt}{2}\text{TFORCES}_{\ib}}_{\text{IF USE\_MINION}}\end{aligned}\end{split}\]</div>
<p><strong>If</strong> USE_MINION <strong>and</strong> ICONSERVE <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-71">
<span class="eqno">(242)<a class="headerlink" href="#equation-godunov-71" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_L^x &amp;=&amp; s_L^x - \frac{\dt}{2}s_{\ib-\eb_x}\text{DIVU}_{\ib-\eb_x} \\
s_R^x &amp;=&amp; s_R^x - \frac{\dt}{2}s_{\ib}\text{DIVU}_{\ib}\end{aligned}\end{split}\]</div>
<p>Apply boundary conditions on <span class="math notranslate nohighlight">\(s_L^x\)</span> and <span class="math notranslate nohighlight">\(s_R^x\)</span>. Then,</p>
<div class="math notranslate nohighlight" id="equation-estate-fpu-upwind">
<span class="eqno">(243)<a class="headerlink" href="#equation-estate-fpu-upwind" title="Link to this equation"></a></span>\[\begin{split}\text{s}_{\ib-\half\eb_x}^x =
\begin{cases}
s_L^x, &amp; \text{UEDGE}_{\ib-\half\eb_x} &gt; 0, \\
s_R^x, &amp; \text{else}. \\
\end{cases}\end{split}\]</div>
</li>
<li><p>Then, if <span class="math notranslate nohighlight">\(|\text{UEDGE}_{\ib-\half\eb_x}| \le \epsilon\)</span>, we set <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}^x = (s_L^x+s_R^x)/2\)</span>. The procedure to obtain <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_y}^y\)</span> is analogous.</p></li>
<li><p>Now, the transverse terms.</p>
<p><strong>If</strong> ICONSERVE <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-72">
<span class="eqno">(244)<a class="headerlink" href="#equation-godunov-72" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\text{sedge}_L^x &amp;=&amp; s_{\ib-\eb_x} + \left(\half - \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib-\eb_x} + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{\text{VEDGE}_{\ib-\eb_x+\half\eb_y}s_{\ib-\eb_x+\half\eb_y}^y - \text{VEDGE}_{\ib-\eb_x-\half\eb_y}s_{\ib-\eb_x-\half\eb_y}^y}{h_y}\right.\nonumber\\
&amp;&amp; ~~~~~~~~~~ \left. - \frac{s_{\ib-\eb_x}(\text{VEDGE}_{\ib-\eb_x+\half\eb_y}-\text{VEDGE}_{\ib-\eb_x-\half\eb_y})}{h_y}+s_{\ib-\eb_x}\text{DIVU}_{\ib-\eb_x}\right]\\
\text{sedge}_R^x &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{\text{VEDGE}_{\ib+\half\eb_y}s_{\ib+\half\eb_y}^y - \text{VEDGE}_{\ib-\half\eb_y}s_{\ib-\half\eb_y}^y}{h_y}\right.\nonumber\\
&amp;&amp; ~~~~~~~~~~ \left. - \frac{s_{\ib}(\text{VEDGE}_{\ib+\half\eb_y}-\text{VEDGE}_{\ib-\half\eb_y})}{h_y}+s_{\ib}\text{DIVU}_{\ib}\right]\end{aligned}\end{split}\]</div>
</li>
<li><p>Now, define <span class="math notranslate nohighlight">\(\text{VBAR}_{\ib} = (\text{VEDGE}_{\ib+\half\eb_y}+\text{VEDGE}_{\ib-\half\eb_y})/2\)</span>.</p>
<p><strong>If</strong> NOT ICONSERVE <strong>and</strong> <span class="math notranslate nohighlight">\(\text{VEDGE}_{\ib+\half\eb_y}\cdot\text{VEDGE}_{\ib-\half\eb_y} &lt; 0\)</span> <strong>and</strong> <span class="math notranslate nohighlight">\(\text{VBAR}_{\ib} &lt; 0\)</span> <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-transverse-upwinding-1">
<span class="eqno">(245)<a class="headerlink" href="#equation-transverse-upwinding-1" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\text{sedge}_L^x = s_{\ib-\eb_x} &amp;+ \left(\half - \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \nonumber\\
&amp; - \frac{\dt}{2}\left[\frac{\text{VBAR}_{\ib-\eb_x}(s_{\ib-\eb_x+\eb_y}-s_{\ib-\eb_x})}{h_y}\right]
\end{align}\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-73">
<span class="eqno">(246)<a class="headerlink" href="#equation-godunov-73" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\text{sedge}_R^x = s_{\ib} &amp;- \left(\half + \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib} \nonumber\\
&amp; - \frac{\dt}{2}\left[\frac{\text{VBAR}_{\ib}(s_{\ib+\eb_y}-s_{\ib})}{h_y}\right]
\end{align}\end{split}\]</div>
<p><strong>Else If</strong> NOT ICONSERVE <strong>and</strong> <span class="math notranslate nohighlight">\(\text{VEDGE}_{\ib+\half\eb_y}\cdot\text{VEDGE}_{\ib-\half\eb_y} &lt; 0\)</span> <strong>and</strong> <span class="math notranslate nohighlight">\(\text{VBAR}_{\ib} \ge 0\)</span> <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-74">
<span class="eqno">(247)<a class="headerlink" href="#equation-godunov-74" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\text{sedge}_L^x = s_{\ib-\eb_x} &amp;+&amp; \left(\half - \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib-\eb_x} + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{\text{VBAR}_{\ib-\eb_x}(s_{\ib-\eb_x}-s_{\ib-\eb_x-\eb_y})}{h_y}\right] \\
\text{sedge}_R^x = s_{\ib} &amp;-&amp; \left(\half + \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{\text{VBAR}_{\ib}(s_{\ib}-s_{\ib-\eb_y})}{h_y}\right]\end{aligned}\end{split}\]</div>
<p><strong>Else If</strong> NOT ICONSERVE <strong>and</strong> <span class="math notranslate nohighlight">\(\text{VEDGE}_{\ib+\half\eb_y}\cdot\text{VEDGE}_{\ib-\half\eb_y} \ge 0\)</span> <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-transverse-upwinding-6">
<span class="eqno">(248)<a class="headerlink" href="#equation-transverse-upwinding-6" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\text{sedge}_L^x &amp;= s_{\ib-\eb_x} + \left(\half - \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib-\eb_x} + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{(\text{VEDGE}_{\ib-\eb_x+\half\eb_y}+\text{VEDGE}_{\ib-\eb_x-\half\eb_y})(s_{\ib-\eb_x+\half\eb_y}-s_{\ib-\eb_x-\half\eb_y})}{2h_y}\right] \\
\text{sedge}_R^x &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{h_x}\text{UEDGE}_{\ib-\half\eb_x}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{(\text{VEDGE}_{\ib+\half\eb_y}+\text{VEDGE}_{\ib-\half\eb_y})(s_{\ib+\half\eb_y}-s_{\ib-\half\eb_y})}{2h_y}\right]
\end{align}\end{split}\]</div>
</li>
<li><p>Finally, upwind analogous to <a class="reference internal" href="#equation-estate-fpu-upwind">Eq.243</a> to get <span class="math notranslate nohighlight">\(\text{sedge}_{\ib-\half\eb_x}\)</span>.</p></li>
</ul>
</section>
<section id="estate-in-godunov-2d-3d-f">
<h2>ESTATE in GODUNOV_2D/3D.f<a class="headerlink" href="#estate-in-godunov-2d-3d-f" title="Link to this heading"></a></h2>
<p>First, the normal predictor.</p>
<div class="math notranslate nohighlight" id="equation-godunov-75">
<span class="eqno">(249)<a class="headerlink" href="#equation-godunov-75" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_L^x &amp;=&amp; s_{\ib-\eb_x} + \left(\half - \frac{\dt}{h_x}u_{\ib-\eb_x}\right)\Delta^x s_{\ib-\eb_x} \\
s_R^x &amp;=&amp; s_{\ib} - \left(\half + \frac{\dt}{h_x}u_{\ib}\right)\Delta^x s_{\ib}\end{aligned}\end{split}\]</div>
<p><strong>If</strong> USE_MINION <strong>then:</strong></p>
<div class="math notranslate nohighlight" id="equation-godunov-76">
<span class="eqno">(250)<a class="headerlink" href="#equation-godunov-76" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_L^x &amp;=&amp; s_L^x + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \\
s_R^x &amp;=&amp; s_R^x + \frac{\dt}{2}\text{TFORCES}_{\ib}\end{aligned}\end{split}\]</div>
<p>Apply boundary conditions on <span class="math notranslate nohighlight">\(s_L^x\)</span> and <span class="math notranslate nohighlight">\(s_R^x\)</span>. Then,</p>
<div class="math notranslate nohighlight" id="equation-estate-upwind">
<span class="eqno">(251)<a class="headerlink" href="#equation-estate-upwind" title="Link to this equation"></a></span>\[\begin{split}\text{s}_{\ib-\half\eb_x}^x =
\begin{cases}
s_L^x, &amp; \text{UAD}_{\ib-\half\eb_x} &gt; 0, \\
s_R^x, &amp; \text{else}. \\
\end{cases}\end{split}\]</div>
<p>Then, if <span class="math notranslate nohighlight">\(|\text{UAD}_{\ib-\half\eb_x}| \le \epsilon\)</span>, we set <span class="math notranslate nohighlight">\(s_{\ib-\half\eb_x}^x = (s_L^x+s_R^x)/2\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-godunov-77">
<span class="eqno">(252)<a class="headerlink" href="#equation-godunov-77" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\text{sedge}_L^x = s_{\ib-\eb_x} &amp;+&amp; \left(\half - \frac{\dt}{h_x}u_{\ib-\eb_x}\right)\Delta^x s_{\ib-\eb_x} + \frac{\dt}{2}\text{TFORCES}_{\ib-\eb_x} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{(\text{VAD}_{\ib-\eb_x+\half\eb_y}+\text{VAD}_{\ib-\eb_x-\half\eb_y})(s_{\ib-\eb_x+\half\eb_y}-s_{\ib-\eb_x-\half\eb_y})}{2h_y}\right] \\
\text{sedge}_R^x = s_{\ib} &amp;-&amp; \left(\half + \frac{\dt}{h_x}u_{\ib}\right)\Delta^x s_{\ib} + \frac{\dt}{2}\text{TFORCES}_{\ib} \nonumber\\
&amp;&amp; - \frac{\dt}{2}\left[\frac{(\text{VAD}_{\ib+\half\eb_y}+\text{VAD}_{\ib-\half\eb_y})(s_{\ib+\half\eb_y}-s_{\ib-\half\eb_y})}{2h_y}\right]\end{aligned}\end{split}\]</div>
<p>Note that the 2D and 3D algorithms are different - in 3D the transverse
terms use upwinding analogous to <a class="reference internal" href="#equation-transverse-upwinding-1">Eq.245</a>-<a class="reference internal" href="#equation-transverse-upwinding-6">Eq.248</a>, using UAD
instead of UEDGE. Finally, upwind analogous to <a class="reference internal" href="#equation-estate-upwind">Eq.251</a>
to get <span class="math notranslate nohighlight">\(\text{sedge}_{\ib-\half\eb_x}\)</span>, but use UEDGE instead of UAD.</p>
</section>
<section id="piecewise-parabolic-method-ppm">
<h2>Piecewise Parabolic Method (PPM)<a class="headerlink" href="#piecewise-parabolic-method-ppm" title="Link to this heading"></a></h2>
<p>Consider a scalar, <span class="math notranslate nohighlight">\(s\)</span>, which we wish to predict to
time-centered edges.  The PPM method is an improvement over the
piecewise-linear method.  Using our notation, we modify equations
(<a class="reference internal" href="#equation-3d-predict-s-to-left">Eq.209</a> and <a class="reference internal" href="#equation-3d-predict-s-to-right">Eq.210</a>) in Section <a class="reference external" href="#ScalarEdgeStatePredictioninMAESTROeX">4</a> to obtain better estimates for the
time-centered 1D edge states, <span class="math notranslate nohighlight">\(s_{L/R,\ib-\myhalf\eb_x}\)</span>,
etc.. Once these states are obtained, we continue with the
full-dimensional extrapolations as described before.</p>
<p>The PPM method is described in a series of papers:</p>
<ul class="simple">
<li><p>Colella and Woodward 1984 - describes the basic method.</p></li>
<li><p>Miller and Colella 2002 - describes how to apply PPM to a multidimensional
unsplit Godunov method and generalizes the characteristic tracing for more complicated
systems. Note that we only need to upwind based on the fluid velocity, so we don’t
need to use fancy characteristic tracing.</p></li>
<li><p>Colella and Sekora 2008 - describes new fancy quadratic limiters. There are
several errors in the printed text, so we have implemented a corrected version from
Phil Colella.</p></li>
</ul>
<p>Here are the steps for the <span class="math notranslate nohighlight">\(x\)</span>-direction. For simplicity, we replace the vector index notation with a simple scalar notation (<span class="math notranslate nohighlight">\(\ib+\eb_x \rightarrow i+1\)</span>, etc.).</p>
<ul>
<li><p><strong>Step 1:</strong> Compute <span class="math notranslate nohighlight">\(s_{i,+}\)</span> and <span class="math notranslate nohighlight">\(s_{i,-}\)</span>, which are spatial interpolations of
<span class="math notranslate nohighlight">\(s\)</span> to the hi and lo faces of cell <span class="math notranslate nohighlight">\(i\)</span>, respectively. See Sections
<a class="reference external" href="#Sec:ColellaWoodward">9.1</a> and <a class="reference external" href="#Sec:ColellaSekora">9.2</a> for the two options.</p></li>
<li><p><strong>Step 2:</strong> Construct a quadratic profile within each cell.</p>
<div class="math notranslate nohighlight" id="equation-godunov-78">
<span class="eqno">(253)<a class="headerlink" href="#equation-godunov-78" title="Link to this equation"></a></span>\[s_i^I(x) = s_{i,-} + \xi\left[s_{i,+} - s_{i,-} + s_{6,i}(1-\xi)\right],\label{Quadratic Interp}\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-79">
<span class="eqno">(254)<a class="headerlink" href="#equation-godunov-79" title="Link to this equation"></a></span>\[s_{6,i}= 6s_{i} - 3\left(s_{i,-}+s_{i,+}\right),\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-80">
<span class="eqno">(255)<a class="headerlink" href="#equation-godunov-80" title="Link to this equation"></a></span>\[\xi = \frac{x - (i-\myhalf)h}{h}, ~ 0 \le \xi \le 1.\]</div>
</li>
<li><p><strong>Step 3:</strong> Integrate quadratic profiles to get the average value swept over the face
over time.
Define the following integrals, where <span class="math notranslate nohighlight">\(\sigma = |u|\Delta t/h\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-godunov-81">
<span class="eqno">(256)<a class="headerlink" href="#equation-godunov-81" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\mathcal{I}_{i,+}(\sigma) &amp;=&amp; \frac{1}{\sigma h}\int_{(i+\myhalf)h-\sigma h}^{(i+\myhalf)h}s_i^I(x)dx \\
\mathcal{I}_{i,-}(\sigma) &amp;=&amp; \frac{1}{\sigma h}\int_{(i-\myhalf)h}^{(i-\myhalf)h+\sigma h}s_i^I(x)dx\end{aligned}\end{split}\]</div>
<p>Plugging in (<a class="reference external" href="#QuadraticInterp">[Quadratic Interp]</a>) gives:</p>
<div class="math notranslate nohighlight" id="equation-godunov-82">
<span class="eqno">(257)<a class="headerlink" href="#equation-godunov-82" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
\mathcal{I}_{i,+}(\sigma) &amp;=&amp; s_{j,+} - \frac{\sigma}{2}\left[s_{j,+}-s_{j,-}-\left(1-\frac{2}{3}\sigma\right)s_{6,i}\right], \\
\mathcal{I}_{i,-}(\sigma) &amp;=&amp; s_{j,-} + \frac{\sigma}{2}\left[s_{j,+}-s_{j,-}+\left(1-\frac{2}{3}\sigma\right)s_{6,i}\right].\end{aligned}\end{split}\]</div>
</li>
<li><p><strong>Step 4:</strong> Obtain 1D edge states.
Perform a 1D extrapolation, without source terms, to get
left and right edge states. Add the source terms later if desired/necessary.</p>
<div class="math notranslate nohighlight" id="equation-godunov-83">
<span class="eqno">(258)<a class="headerlink" href="#equation-godunov-83" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
s_{L,i-\myhalf} &amp;=&amp;
\begin{cases}
\mathcal{I}_{i-1,+}(\sigma), &amp; u_{i-1} ~ \text{or} ~ u_{i-\myhalf}^{\mac} &gt; 0 \\
s_{i-1}, &amp; \text{else}.
\end{cases}\\
s_{R,i-\myhalf} &amp;=&amp;
\begin{cases}
\mathcal{I}_{i,-}(\sigma), &amp; u_{i} ~ \text{or} ~ u_{i-\myhalf}^{\mac} &lt; 0 \\
s_{i}, &amp; \text{else}.
\end{cases}\end{aligned}\end{split}\]</div>
</li>
</ul>
<section id="colella-and-woodward-based-approach">
<span id="sec-colellawoodward"></span><h3>Colella and Woodward Based Approach<a class="headerlink" href="#colella-and-woodward-based-approach" title="Link to this heading"></a></h3>
<p>Spatially interpolate <span class="math notranslate nohighlight">\(s\)</span> to edges.
Use a 4th-order interpolation in space with van Leer limiting to obtain edge values:</p>
<div class="math notranslate nohighlight" id="equation-eq-cw-edge">
<span class="eqno">(259)<a class="headerlink" href="#equation-eq-cw-edge" title="Link to this equation"></a></span>\[s_{i+\myhalf} = \frac{1}{2}\left(s_{i} + s_{i+1}\right) - \frac{1}{6}\left(\delta s_{i+1}^{vL} - \delta s_{i}^{vL}\right),\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-84">
<span class="eqno">(260)<a class="headerlink" href="#equation-godunov-84" title="Link to this equation"></a></span>\[\delta s_i =
\frac{1}{2}\left(s_{i+1}-s_{i-1}\right),\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-85">
<span class="eqno">(261)<a class="headerlink" href="#equation-godunov-85" title="Link to this equation"></a></span>\[\begin{split}\delta s_i^{vL} =
\begin{cases}
\text{sign}(\delta s_i)\min\left(|\delta s_i|, ~ 2|s_{i+1}-s_{i}|, ~ 2|s_i-s_{i-1}|\right), &amp; {\rm if} ~ (s_{i+1}-s_i)(s_i-s_{i-1}) &gt; 0,\\
0, &amp; {\rm otherwise}.
\end{cases}\end{split}\]</div>
<p>A more compact way of writing this is</p>
<div class="math notranslate nohighlight" id="equation-godunov-86">
<span class="eqno">(262)<a class="headerlink" href="#equation-godunov-86" title="Link to this equation"></a></span>\[s = \text{sign}(\delta s_i),\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-87">
<span class="eqno">(263)<a class="headerlink" href="#equation-godunov-87" title="Link to this equation"></a></span>\[\delta s_i^{vL} = s\max\left\{\min\left[s\delta s_i, 2s(s_{i+1}-s_i),2s(s_i-s_{i-1})\right],0\right\}\]</div>
<p>Without the limiters, <a class="reference internal" href="#equation-eq-cw-edge">Eq.259</a> is the familiar 4th-order spatial interpolation formula:</p>
<div class="math notranslate nohighlight" id="equation-godunov-88">
<span class="eqno">(264)<a class="headerlink" href="#equation-godunov-88" title="Link to this equation"></a></span>\[s_{i+\myhalf} = \frac{7}{12}\left(s_{i+1}+s_i\right) - \frac{1}{12}\left(s_{i+2}+s_{i-1}\right).\]</div>
<p>Next, we must ensure that <span class="math notranslate nohighlight">\(s_{i+\myhalf}\)</span> lies between the adjacent
cell-centered values:</p>
<div class="math notranslate nohighlight" id="equation-godunov-89">
<span class="eqno">(265)<a class="headerlink" href="#equation-godunov-89" title="Link to this equation"></a></span>\[\min\left(s_{i},s_{i+1}\right) \le s_{i+\myhalf} \le \max\left(s_{i},s_{i+1}\right).\]</div>
<p>In anticipation of further limiting, we set double-valued face-centered values:</p>
<div class="math notranslate nohighlight" id="equation-godunov-90">
<span class="eqno">(266)<a class="headerlink" href="#equation-godunov-90" title="Link to this equation"></a></span>\[s_{i,+} = s_{i+1,-} = s_{i+\myhalf}.\]</div>
<p>Modify <span class="math notranslate nohighlight">\(s_{i,\pm}\)</span> using a quadratic limiter.
First, we test whether
<span class="math notranslate nohighlight">\(s_i\)</span> is a local extreumum with the condition:</p>
<div class="math notranslate nohighlight" id="equation-godunov-91">
<span class="eqno">(267)<a class="headerlink" href="#equation-godunov-91" title="Link to this equation"></a></span>\[\left(s_{i,+}-s_i\right)\left(s_i-s_{i,-}\right) \le 0,\]</div>
<p>If this condition is true, we constrain <span class="math notranslate nohighlight">\(s_{i,\pm}\)</span> by setting
<span class="math notranslate nohighlight">\(s_{i,+} = s_{i,-} = s_i\)</span>. If not, we then apply a second test to determine
whether <span class="math notranslate nohighlight">\(s_i\)</span> is sufficiently close to <span class="math notranslate nohighlight">\(s_{i,\pm}\)</span> so that a quadratic
interpolate would contain a local extremum. We define
<span class="math notranslate nohighlight">\(\alpha_{i,\pm} = s_{i,\pm} - s_i\)</span>. If one of <span class="math notranslate nohighlight">\(|\alpha_{i,\pm}| \ge 2|\alpha_{i,\mp}|\)</span>
holds, then for that choice of <span class="math notranslate nohighlight">\(\pm = +,-\)</span> we set:</p>
<div class="math notranslate nohighlight" id="equation-godunov-92">
<span class="eqno">(268)<a class="headerlink" href="#equation-godunov-92" title="Link to this equation"></a></span>\[s_{i,\pm} = 3s_i - 2s_{i,\mp}.\]</div>
</section>
<section id="colella-and-sekora-based-approach">
<span id="sec-colellasekora"></span><h3>Colella and Sekora Based Approach<a class="headerlink" href="#colella-and-sekora-based-approach" title="Link to this heading"></a></h3>
<ul>
<li><p>Spatially interpolate <span class="math notranslate nohighlight">\(s\)</span> to edges.</p>
<p>Use a 4th-order interpolation in space to obtain edge values:</p>
<div class="math notranslate nohighlight" id="equation-godunov-93">
<span class="eqno">(269)<a class="headerlink" href="#equation-godunov-93" title="Link to this equation"></a></span>\[s_{i+\myhalf} = \frac{7}{12}\left(s_{i+1}+s_i\right) - \frac{1}{12}\left(s_{i+2}+s_{i-1}\right).\]</div>
<p>Then, if <span class="math notranslate nohighlight">\((s_{i+\myhalf}-s_i)(s_{i+1}-s_{i+\myhalf}) &lt; 0\)</span>, we limit <span class="math notranslate nohighlight">\(s_{i+\myhalf}\)</span> using
a nonlinear combination of approximations to the second derivative.
First, define:</p>
<div class="math notranslate nohighlight" id="equation-godunov-94">
<span class="eqno">(270)<a class="headerlink" href="#equation-godunov-94" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
(D^2s)_{i+\myhalf} &amp;=&amp; 3\left(s_{i}-2s_{i+\myhalf}+s_{i+1}\right) \\
(D^2s)_{i+\myhalf,L} &amp;=&amp; s_{i-1}-2s_{i}+s_{i+1} \\
(D^2s)_{i+\myhalf,R} &amp;=&amp; s_{i}-2s_{i+1}+s_{i+2}\end{aligned}\end{split}\]</div>
<p>Then, define</p>
<div class="math notranslate nohighlight" id="equation-godunov-95">
<span class="eqno">(271)<a class="headerlink" href="#equation-godunov-95" title="Link to this equation"></a></span>\[s = \text{sign}\left[(D^2s)_{i+\myhalf}\right],\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-96">
<span class="eqno">(272)<a class="headerlink" href="#equation-godunov-96" title="Link to this equation"></a></span>\[(D^2s)_{i+\myhalf,\text{lim}} = s\max\left\{\min\left[Cs(D^2s)_{i+\myhalf,L},Cs(D^2s)_{i+\myhalf,R},s(D^2s)_{i+\myhalf}\right],0\right\},\]</div>
<p>where <span class="math notranslate nohighlight">\(C=1.25\)</span> was used in Colella and Sekora. Then,</p>
<div class="math notranslate nohighlight" id="equation-godunov-97">
<span class="eqno">(273)<a class="headerlink" href="#equation-godunov-97" title="Link to this equation"></a></span>\[s_{i+\myhalf} = \frac{1}{2}\left(s_{i}+s_{i+1}\right) - \frac{1}{6}(D^2s)_{i+\myhalf,\text{lim}}.\]</div>
<p>Now we implement Phil’s new version of the algorithm to eliminate sensitivity to roundoff.
First we need to detect whether a particular cell corresponds to an “extremum”. There
are two tests. For the first test, define</p>
<div class="math notranslate nohighlight" id="equation-godunov-98">
<span class="eqno">(274)<a class="headerlink" href="#equation-godunov-98" title="Link to this equation"></a></span>\[\alpha_{i,\pm} = s_{i\pm\myhalf} - s_i.\]</div>
<p>If <span class="math notranslate nohighlight">\(\alpha_{i,+}\alpha_{i,-} \ge 0\)</span>, then we are at an extremum. We apply the second
test if either <span class="math notranslate nohighlight">\(|\alpha_{i,\pm}| &gt; 2|\alpha_{i,\mp}|\)</span>. Then, we define:</p>
<div class="math notranslate nohighlight" id="equation-godunov-99">
<span class="eqno">(275)<a class="headerlink" href="#equation-godunov-99" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
(Ds)_{i,{\rm face},-} &amp;=&amp; s_{i-\myhalf} - s_{i-\sfrac{3}{2}} \\
(Ds)_{i,{\rm face},+} &amp;=&amp; s_{i+\sfrac{3}{2}} - s_{i+\myhalf}\end{aligned}\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-100">
<span class="eqno">(276)<a class="headerlink" href="#equation-godunov-100" title="Link to this equation"></a></span>\[(Ds)_{i,{\rm face,min}} = \min\left[\left|(Ds)_{i,{\rm face},-}\right|,\left|(Ds)_{i,{\rm face},+}\right|\right].\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-101">
<span class="eqno">(277)<a class="headerlink" href="#equation-godunov-101" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
(Ds)_{i,{\rm cc},-} &amp;=&amp; s_{i} - s_{i-1} \\
(Ds)_{i,{\rm cc},+} &amp;=&amp; s_{i+1} - s_{i}\end{aligned}\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-102">
<span class="eqno">(278)<a class="headerlink" href="#equation-godunov-102" title="Link to this equation"></a></span>\[(Ds)_{i,{\rm cc,min}} = \min\left[\left|(Ds)_{i,{\rm cc},-}\right|,\left|(Ds)_{i,{\rm cc},+}\right|\right].\]</div>
<p>If <span class="math notranslate nohighlight">\((Ds)_{i,{\rm face,min}} \ge (Ds)_{i,{\rm cc,min}}\)</span>, set
<span class="math notranslate nohighlight">\((Ds)_{i,\pm} = (Ds)_{i,{\rm face},\pm}\)</span>. Otherwise, set
<span class="math notranslate nohighlight">\((Ds)_{i,\pm} = (Ds)_{i,{\rm cc},\pm}\)</span>. Finally, we are at an extreumum if
<span class="math notranslate nohighlight">\((Ds)_{i,+}(Ds)_{i,-} \le 0\)</span>.</p>
</li>
<li><p>Now that we have finished the extremum tests, if we are at an extremum,
we scale <span class="math notranslate nohighlight">\(\alpha_{i,\pm}\)</span>. First, we define</p>
<div class="math notranslate nohighlight" id="equation-godunov-103">
<span class="eqno">(279)<a class="headerlink" href="#equation-godunov-103" title="Link to this equation"></a></span>\[\begin{split}\begin{aligned}
(D^2s)_{i} &amp;=&amp; 6(\alpha_{i,+}+\alpha_{i,-}) \\
(D^2s)_{i,L} &amp;=&amp; s_{i-2}-2s_{i-1}+s_{i} \\
(D^2s)_{i,R} &amp;=&amp; s_{i}-2s_{i+1}+s_{i+2} \\
(D^2s)_{i,C} &amp;=&amp; s_{i-1}-2s_{i}+s_{i+1}\end{aligned}\end{split}\]</div>
<p>Then, define</p>
<div class="math notranslate nohighlight" id="equation-godunov-104">
<span class="eqno">(280)<a class="headerlink" href="#equation-godunov-104" title="Link to this equation"></a></span>\[s = \text{sign}\left[(D^2s)_{i}\right],\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-105">
<span class="eqno">(281)<a class="headerlink" href="#equation-godunov-105" title="Link to this equation"></a></span>\[(D^2s)_{i,\text{lim}} = \max\left\{\min\left[s(D^2s)_{i},Cs(D^2s)_{i,L},Cs(D^2s)_{i,R},Cs(D^2s)_{i,C}\right],0\right\}.\]</div>
<p>Then,</p>
<div class="math notranslate nohighlight" id="equation-godunov-106">
<span class="eqno">(282)<a class="headerlink" href="#equation-godunov-106" title="Link to this equation"></a></span>\[\alpha_{i,\pm} = \frac{\alpha_{i,\pm}(D^2s)_{i,\text{lim}}}{\max\left[\left|(D^2s)_{i}\right|,1\times 10^{-10}\right]}\]</div>
<p>Otherwise, if we are not at an extremum and <span class="math notranslate nohighlight">\(|\alpha_{i,\pm}| &gt; 2|\alpha_{i,\mp}|\)</span>,
then define</p>
<div class="math notranslate nohighlight" id="equation-godunov-107">
<span class="eqno">(283)<a class="headerlink" href="#equation-godunov-107" title="Link to this equation"></a></span>\[s = \text{sign}(\alpha_{i,\mp})\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-108">
<span class="eqno">(284)<a class="headerlink" href="#equation-godunov-108" title="Link to this equation"></a></span>\[\delta\mathcal{I}_{\text{ext}} = \frac{-\alpha_{i,\pm}^2}{4\left(\alpha_{j,+}+\alpha_{j,-}\right)},\]</div>
<div class="math notranslate nohighlight" id="equation-godunov-109">
<span class="eqno">(285)<a class="headerlink" href="#equation-godunov-109" title="Link to this equation"></a></span>\[\delta s = s_{i\mp 1} - s_i,\]</div>
<p>If <span class="math notranslate nohighlight">\(s\delta\mathcal{I}_{\text{ext}} \ge s\delta s\)</span>, then we perform the following test.
If <span class="math notranslate nohighlight">\(s\delta s - \alpha_{i,\mp} \ge 1\times 10^{-10}\)</span>, then</p>
<div class="math notranslate nohighlight" id="equation-godunov-110">
<span class="eqno">(286)<a class="headerlink" href="#equation-godunov-110" title="Link to this equation"></a></span>\[\alpha_{i,\pm} =  -2\delta s - 2s\left[(\delta s)^2 - \delta s \alpha_{i,\mp}\right]^{\myhalf}\]</div>
<p>otherwise,</p>
<div class="math notranslate nohighlight" id="equation-godunov-111">
<span class="eqno">(287)<a class="headerlink" href="#equation-godunov-111" title="Link to this equation"></a></span>\[\alpha_{i,\pm} =  -2\alpha_{i,\mp}\]</div>
<p>Finally, <span class="math notranslate nohighlight">\(s_{i,\pm} = s_i + \alpha_{i,\pm}\)</span>.</p>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pert.html" class="btn btn-neutral float-left" title="Interface State Details" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mg.html" class="btn btn-neutral float-right" title="Multigrid" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, MAESTROeX development tem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>