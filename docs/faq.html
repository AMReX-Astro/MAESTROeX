<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frequently Asked Questions &mdash; MAESTROeX  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css?v=10589de1" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "macros": {"rhozero": "{\\rho_0}", "pizero": "{\\pi_0}", "pizeroone": "{\\pi_0^{(1)}}", "pizerotwo": "{\\pi_0^{(2)}}", "gammabar": "{\\overline{\\Gamma}_1}", "ptl": "{\\partial}", "eb": "{{\\bf e}}", "fb": "{{\\bf f}}", "ib": "{{\\bf i}}", "Ub": "{{\\bf U}}", "Vb": "{{\\bf V}}", "xb": "{{\\bf x}}", "ut": "{{\\tilde{u}}}", "vt": "{{\\tilde{v}}}", "wt": "{{\\tilde{w}}}", "Ubt": "{\\widetilde{\\Ub}}", "edge": "{{\\rm EDGE}}", "mac": "{{\\rm MAC}}", "trans": "{{\\rm TRANS}}", "nablab": "{\\mathbf{\\nabla}}", "cdotb": "{\\mathbf{\\cdot}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\frac{1}{2}}", "nph": "{{n + \\myhalf}}", "nmh": "{{n - \\myhalf}}", "Hext": "{{H_{\\rm ext}}}", "Hnuc": "{{H_{\\rm nuc}}}", "kth": "{k_{\\rm th}}", "init": "{\\rm init}", "model": "{\\rm model}", "raw": "{\\rm raw}", "pred": "{{\\rm pred}}", "Sbar": "{\\overline{S}}", "inp": "{\\mathrm{in}}", "initp": "{\\mathrm{init}}", "outp": "{\\mathrm{out}}", "uadv": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvone": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV},\\star}}", "uadvonedag": "{\\Ubt^{\\mathrm{ADV},\\dagger,\\star}}", "uadvtwo": "{\\widetilde{\\mathbf{U}}^{\\mathrm{ADV}}}", "uadvtwodag": "{\\Ubt^{\\mathrm{ADV},\\dagger}}", "uadvsdcstar": "{\\mathbf{U}^{\\mathrm{ADV},\\star}}", "uadvsdcpred": "{\\mathbf{U}^{\\mathrm{ADV},\\mathrm{pred}}}", "uadvsdc": "{\\mathbf{U}^{\\mathrm{ADV}}}", "dt": "{\\Delta t}", "dr": "{\\Delta r}", "etarho": "{\\eta_{\\rho}}", "etarhoec": "{\\etarho^{\\rm ec}}", "etarhocc": "{\\etarho^{\\rm cc}}", "etarhoflux": "{\\etarho^{\\rm flux}}", "divetarho": "{\\nabla\\cdot(\\etarho\\eb_r)}", "ow": "{\\overline{w}_0}", "dw": "{\\delta w_0}", "thalf": "{\\frac{3}{2}}", "rhop": "{{\\rho^{\\prime}}}", "omegadot": "{\\dot{\\omega}}", "er": "{\\mathbf{e}_r}", "ex": "{\\mathbf{e}_x}", "ey": "{\\mathbf{e}_y}", "ez": "{\\mathbf{e}_z}", "Omegab": "{{\\bf \\Omega}}", "rb": "{{\\bf r}}", "boxtype": "{{\\tt box\\/}}", "fab": "{{\\tt fab\\/}}", "multifab": "{{\\tt multifab\\/}}", "boxarray": "{{\\tt boxarray\\/}}", "mlboxarray": "{{\\tt ml\\_boxarray\\/}}", "layout": "{{\\tt layout\\/}}", "mllayout": "{{\\tt ml\\_layout\\/}}", "bctower": "{{\\tt bc\\_tower\\/}}", "bclevel": "{{\\tt bc\\_level\\/}}", "mgtower": "{{\\tt mg\\_tower\\/}}", "bndryreg": "{{\\tt bndry\\_reg\\/}}", "runparam": ["{\\index{Runtime parameters!{\\tt #1}}{\\tt #1}}", 1], "runparamidx": ["{\\index{Runtime parameters!{\\tt #1}}}", 1], "code": ["{\\index{Code reference!{\\tt #1}}{\\tt #1}}", 1], "codeidx": ["{\\index{Code reference!{\\tt #1}}}", 1], "otherindex": ["{\\index{#1!#2}}", 2], "fdamp": "{{f_\\mathrm{damp}}}"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Low Density Cutoffs" href="lo_density.html" />
    <link rel="prev" title="Managing Jobs" href="managingjobs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            MAESTROeX
              <img src="_static/maestroex_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <div class="branch">
        Branch: <a href="./faq.html">main</a> | <a href="./dev/faq.html">development</a>
    </div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">MAESTROeX basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html">Governing Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html#numerical-methodology">Numerical Methodology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using MAESTROeX</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="addproblem.html">Adding A New Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Problem Setups</a></li>
<li class="toctree-l1"><a class="reference internal" href="unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="param_intro.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial_models.html">Initial Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_state.html">Base State</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="makefiles.html">MAESTROeX Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="managingjobs.html">Managing Jobs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compiling">Compiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-o">I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis">Analysis</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MAESTROeX technical details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lo_density.html">Low Density Cutoffs</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume_discrepancy.html">Volume Discrepancy Factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="eos_notes.html">Equation of State Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Reaction Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html">The Mixing Term, <span class="math notranslate nohighlight">\(\etarho\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#eta-flow-chart"><span class="math notranslate nohighlight">\(\eta\)</span> Flow Chart</a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#computing-etarhoec-and-etarhocc">Computing <span class="math notranslate nohighlight">\(\etarhoec\)</span> and <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhoec">Using <span class="math notranslate nohighlight">\(\etarhoec\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="eta.html#using-etarhocc">Using <span class="math notranslate nohighlight">\(\etarhocc\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="pert.html">Interface State Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="Godunov.html">Godunov Interface States</a></li>
<li class="toctree-l1"><a class="reference internal" href="mg.html">Multigrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="rotation.html">Rotation in MAESTROeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="spherical_basestate.html">Modifications for a Spherical Self-Gravitating Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="planar_invsq_basestate.html">Modifications for a <span class="math notranslate nohighlight">\(1/r^2\)</span> Plane-Parallel Basestate</a></li>
<li class="toctree-l1"><a class="reference internal" href="thermo_notes.html">Notes on Thermodynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="beta0.html">Notes on <span class="math notranslate nohighlight">\(\beta_0\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="enthalpy.html">Notes on Enthalpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="regtest.html">Regression Testing and Continuous Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAESTROeX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Frequently Asked Questions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/faq.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h1>
<section id="compiling">
<h2>Compiling<a class="headerlink" href="#compiling" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>What version of the C++ is needed?</em></p>
<p>We use C++17.  Most modern compilers support the features we need.</p>
</li>
<li><p><em>The code doesn’t compile, but complains right away that there
is “No rule to make target ‘AMReX_constants_mod.o’, needed by ‘tmp_build_dir/d/2d.gnu.MPI/f90.depends’”</em></p>
<p>The environment variable <code class="docutils literal notranslate"><span class="pre">AMREX_HOME</span></code> needs to be the full path
to the <code class="docutils literal notranslate"><span class="pre">amrex/</span></code> directory. You cannot use ‘<span class="math notranslate nohighlight">\(\sim\)</span>’ as a shortcut
for your home directory.</p>
</li>
<li><p><em>make issues an error like:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make
Loading /home/zingale/development/amrex//Tools/GNUMake/comps/gnu.mak...
Loading /home/zingale/development/amrex//Tools/GNUMake/sites/Make.unknown...
/home/zingale/development/amrex//Tools/GNUMake/Make.rules:476: tmp_build_dir/d/3d.gnu.MPI.EXE/f90.depends: No such file or directory
make: *** No rule to make target `meth_params.F90&#39;, needed by `tmp_build_dir/d/3d.gnu.MPI.EXE/f90.depends&#39;.  Stop.
</pre></div>
</div>
<p>You need to use GNU make version 3.82 or later.</p>
</li>
</ol>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>How do we turn off all the initial projections to look at the
initial velocity field as specified in initdata, instead of as
modified by the velocity constraint?</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maestro</span><span class="o">.</span><span class="n">max_step</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="n">maestro</span><span class="o">.</span><span class="n">init_iter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">maestro</span><span class="o">.</span><span class="n">init_divu_iter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">maestro</span><span class="o">.</span><span class="n">do_initial_projection</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
</li>
<li><p><em>MAESTROeX crashes because the multigrid algorithm fails to
converge—how do I get around this?</em></p>
<p>Setting general convergence criteria for multigrid is as much
art as science.
First, it is important to determine if the multigrd solver is
close to convergence and just dancing around near the desired
tolerance, but never reaching it, or if it is no where near
convergence. For the latter, it may be that the multigrid
solver was fed bad data and the problem arose in one of the earlier
steps. To get more detail information from the multigrid solver,
set mg_verbose to a positive integer from 1-4 (the higher
the number the more information you receive.</p>
<p>If the multigrid solver is failing during one of the initial
“divu” iterations, it may be because the velocity is initially
zero, so there is no velocity magnitude to use as a reference for
convergence, and that (<span class="math notranslate nohighlight">\(S - \bar{S}\)</span>) is very small (or zero). In
this case, it is usually a good idea to perturb the initial state
slightly, so the righthand side is non-zero.</p>
<p>The tolerances used for the various multigrid solves in the code
can be overridden on a problem-by-problem basis by setting the relevant
parameters in the problem’s inputs file (see the <cite>solver tolerances</cite> section in the § <a class="reference internal" href="runtime_parameters.html#sec-runtime-parameters-tables"><span class="std std-ref">runtime parameters tables</span></a>).</p>
</li>
<li><p><em>Why do the initial projection and “divu” iters sometimes
have a harder time converging than the multigrid solves in the main algorithm?</em></p>
<p>The initial projection and “divu” solve sets the density to <span class="math notranslate nohighlight">\(1\)</span>
(see § <a class="reference internal" href="flowchart.html#sec-initialization"><span class="std std-ref">Initialization</span></a>), so the coefficients in the
elliptic solve are <span class="math notranslate nohighlight">\(O(\beta_0) \sim O(\rho)\)</span>. But in the main
algorithm, the coefficients are <span class="math notranslate nohighlight">\(O(\beta_0/\rho) \sim O(1)\)</span>. Since
<span class="math notranslate nohighlight">\(\rho\)</span> can vary a lot, the variation in the coefficients in the
initial projection and “divu” solve present a harded linear system
to solve.</p>
</li>
<li><p><em>How can I obtain profiling information for my run?</em></p>
<p>The code is already instrumented with timers. Simply compile with
<code class="docutils literal notranslate"><span class="pre">TINY_PROFILE=TRUE</span></code> in the <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code>, or equivalently do
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TINY_PROFILE=TRUE</span></code>. A summary of the timings will
be output to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> at the end of the run.</p>
<p>With the GNU compilers, you can enabling profiling with <code class="docutils literal notranslate"><span class="pre">gprof</span></code>
by compiling with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USE_GPROF</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>in your GNUmakefile.</p>
<p>When you run, a file named <code class="docutils literal notranslate"><span class="pre">gmon.out</span></code> will be produced. This can
be processed with <code class="docutils literal notranslate"><span class="pre">gprof</span></code> by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gprof</span> <span class="n">exec</span><span class="o">-</span><span class="n">name</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">exec-name</span></code> is the name of the executable. More detailed
line-by-line information can be obtained by passing the <code class="docutils literal notranslate"><span class="pre">-l</span></code>
argument to <code class="docutils literal notranslate"><span class="pre">gprof</span></code>.</p>
</li>
<li><p><em>How can I force MAESTROeX to output?</em></p>
<p>To generate a checkpoint file, in the output directory do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">touch<span class="w"> </span>dump_and_continue</span>
</pre></div></div><p>For a plotfile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">touch<span class="w"> </span>plot_and_continue</span>
</pre></div></div><p>or a small plotfile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt2:before {
  content: " ";
}
</style><span class="prompt2">touch small_plot_and_continue</span>
</pre></div></div><p>At the end of a timestep, the code will check if these files exist
and if so do an output and then remove the file.</p>
</li>
<li><p><em>How can I check the compilation parameters of a MAESTROeX executable?</em></p>
<p>The build information (including git hashes, modules, EoS, network, etc.) can be displayed by running the executable as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">Maestro</span><span class="o">.</span><span class="n">exe</span> <span class="o">--</span><span class="n">describe</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>How can we dump out a variable to a plotfile from any point in the
code?</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;AMReX_VisMF.H&gt;</span>

<span class="n">VisMF</span><span class="p">::</span><span class="n">Write</span><span class="p">(</span><span class="n">uold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;a_uold&quot;</span><span class="p">);</span>
<span class="n">VisMF</span><span class="p">::</span><span class="n">Write</span><span class="p">(</span><span class="n">umac</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;a_umacx&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This plotfile is visualized using Amrvis using the flag <code class="docutils literal notranslate"><span class="pre">-mf</span></code>.</p>
</li>
<li><p><em>How can I print out a MultiFab’s contents from within the code?</em></p>
<p>There is a print subroutine in <code class="docutils literal notranslate"><span class="pre">MaestroDebug.cpp</span></code> file. This can
be simply called as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PrintMF</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">a</span></code> is a MultiFab (multi-level).</p>
</li>
<li><p><em>How can I debug a parallel (MPI) job with gdb?</em></p>
<p>If you only need to use a few processors, the following command will work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpiexec</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="n">xterm</span> <span class="o">-</span><span class="n">e</span> <span class="n">gdb</span> <span class="o">./</span><span class="n">Maestro2d</span><span class="o">.</span><span class="n">gnu</span><span class="o">.</span><span class="n">ex</span>
</pre></div>
</div>
<p>where the executable needs to be created with the <code class="docutils literal notranslate"><span class="pre">-g</span></code> flag to
the compiler. This will pop up multiple xterms with gdb running
in each. You need to then issue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">inputs</span>
</pre></div>
</div>
<p>where inputs is the desired inputs file <em>in each</em> xterm.</p>
</li>
<li><p><em>How can I get more information about floating point exceptions?</em></p>
<p>AMReX can intercept floating point exceptions and provide a helpful
backtrace file that shows you where they were generated.</p>
</li>
<li><p><em>How can I get information about potential bugs before running the code?</em></p>
<p>We run <a class="reference external" href="https://clang.llvm.org/extra/clang-tidy/">clang-tidy</a> on all pull requests using a <a class="reference external" href="https://github.com/AMReX-Astro/cpp-linter-action">GitHub action</a>. <code class="docutils literal notranslate"><span class="pre">clang-tidy</span></code> analyzes the source code, produces warnings for potential bugs and offers suggestions for performance improvements.</p>
<p><code class="docutils literal notranslate"><span class="pre">clang-tidy</span></code> can also be run locally. This requires the <code class="docutils literal notranslate"><span class="pre">clang-tidy</span></code> and <code class="docutils literal notranslate"><span class="pre">bear</span></code> packages (installed using e.g. <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">bear</span> <span class="pre">clang-tidy</span></code> on Ubuntu), and the python script
<code class="docutils literal notranslate"><span class="pre">run-clang-tidy.py</span></code> (which can be downloaded from <a class="reference external" href="https://github.com/AMReX-Astro/cpp-linter-action/blob/main/run-clang-tidy.py">here</a>). The analysis is performed by first compiling a problem using the <code class="docutils literal notranslate"><span class="pre">bear</span></code> package, then running the python script to analyze the source files. From within a problem directory, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bear<span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="nv">USE_OMP</span><span class="o">=</span>FALSE<span class="w"> </span><span class="nv">USE_MPI</span><span class="o">=</span>FALSE<span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span>TRUE

python3<span class="w"> </span>run-clang-tidy.py<span class="w"> </span>-header-filter<span class="o">=</span><span class="s1">&#39;MAESTROeX&#39;</span><span class="w"> </span>-ignore-files<span class="o">=</span><span class="s1">&#39;amrex|Microphysics&#39;</span><span class="w"> </span>-j<span class="w"> </span><span class="m">20</span><span class="w"> </span>&gt;<span class="w"> </span>clang-tidy-report.txt
</pre></div>
</div>
<p>The compiler flags can be modified to suit the problem to be analyzed, but the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> flag must be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. The <code class="docutils literal notranslate"><span class="pre">header-filter</span></code> option for the python script tells the script to only analyze header files containing the given regex pattern, and the <code class="docutils literal notranslate"><span class="pre">ignore-files</span></code> flag tells it to ignore any source files containing the given regex pattern. The <code class="docutils literal notranslate"><span class="pre">-j</span></code> option tells the script to run a given number of processes in parallel. The output is then redirected to a text file.</p>
</li>
</ol>
</section>
<section id="i-o">
<h2>I/O<a class="headerlink" href="#i-o" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>How can I tell from a plotfile what runtime parameters were
used for its run? or when it was created?</em></p>
<p>In each plotfile directory, there is a file called <code class="docutils literal notranslate"><span class="pre">job_info</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">plt00000/job_info</span></code>) that lists the build directory and
date, as well as the value of every runtime parameter for the run.</p>
</li>
<li><p><em>How can I force the code to output a plotfile / checkpoint
file at the next step?</em></p>
<p>In the output directory (where the code is running) do <code class="docutils literal notranslate"><span class="pre">touch</span>
<span class="pre">.dump_plotfile</span></code>. This will create an empty file called
<code class="docutils literal notranslate"><span class="pre">.dump_plotfile.</span></code> At the end of each step, if the code finds
that file, it will output a plotfile. Simply delete the file to
restore the code to its normal plotfile behavior.</p>
<p>Similarly, creating the file <code class="docutils literal notranslate"><span class="pre">.dump_checkpoint</span></code> will force the
output of a checkpoint file.</p>
</li>
</ol>
</section>
<section id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>Why is MAESTROeX so “hard” to use (e.g. as compared to a
compressible code)?</em></p>
<p>There are several complexities to the algorithm that don’t have
straightforward compressible counterparts. These mainly involve the
role of the base state and the constraint equation.</p>
<p>Care must be taken to setup an initial model/initial base state that
respects the thermodynamics in MAESTROeX and is in hydrostatic equilibrium.
Best results are attained when the model is processed with the MAESTROeX EOS and reset into HSE, as is done in the initial_model routines.
Because MAESTROeX builds off of the base state, any flaws in that initial
state will influence the subsequent behavior of the algorithm.</p>
<p>The constraint equation brings another complexity not seen in compressible
codes—information is instantly communicated
across the grid. In compressible codes you can track down a problem by
watching where it starts from and watching it move one cell per dt. In
MAESTROeX things can go wrong in multiple places without it being obvious
where the root problem is.</p>
</li>
<li><p><em>In the final projection in the algorithm, we project</em> <span class="math notranslate nohighlight">\(U^{n+1}\)</span> <em>,
using a time-centered</em> <span class="math notranslate nohighlight">\(\beta_0\)</span> <em>, a time-centered</em> <span class="math notranslate nohighlight">\(\rho_0\)</span> <em>, but
an</em> “<span class="math notranslate nohighlight">\(n+1\)</span>” <em>-centered</em> <span class="math notranslate nohighlight">\(S\)</span> <em>. Why then is the
resulting</em> <span class="math notranslate nohighlight">\(\phi\)</span> <em>(which then defines</em> <span class="math notranslate nohighlight">\(\pi\)</span> <em>) is
at</em> “<span class="math notranslate nohighlight">\(n+1/2\)</span>” <em>?</em></p>
<p>The short answer to this question is that you should think of this
as really projecting <span class="math notranslate nohighlight">\((U^{n+1} - U^n)\)</span> and the right hand side as having
<span class="math notranslate nohighlight">\((S^{n+1} - S^n)\)</span>. This is because the pressure enters the dynamic equations as
<span class="math notranslate nohighlight">\((U^{n+1} - U^n) = \ldots + \frac{1}{\rho^{n+1/2}} \nabla \pi^{n+1/2}\)</span>.
(We approximate <span class="math notranslate nohighlight">\(\pi^{n+1/2}\)</span> by <span class="math notranslate nohighlight">\(\pi^{n-1/2}\)</span> then do the projection to fix the
<span class="math notranslate nohighlight">\(\pi\)</span> as well as the <span class="math notranslate nohighlight">\(U\)</span>.)</p>
<p>So everything is in fact time-centered.</p>
</li>
<li><p><em>Why is</em> <span class="math notranslate nohighlight">\(\gammabar\)</span> <em>computed as the average of the full
state</em> <span class="math notranslate nohighlight">\(\Gamma_1\)</span> <em>instead of computed from the base state density and
pressure via the equation of state?</em></p>
<p>The primary reason is that there is no base state composition. The
base state density is simply the average of the full state density,
and the base state pressure is the pressure required for hydrostatic
equilibrium. There is no thermodynamic relationship enforced between
these base state quantities.</p>
</li>
<li><p><em>Can I run a full star in 2-d axisymmetric geometry?</em></p>
<p>No. This is a design decision. There is no support for axisymmetric
coordinates in MAESTROeX. Spherical problems must be run in 3-d.</p>
</li>
<li><p><em>Why did we switch all the equations over to the</em> <span class="math notranslate nohighlight">\(\tilde{\Ub}\)</span> <em>form
instead of just working with</em> <span class="math notranslate nohighlight">\(\Ub\)</span> <em>?</em></p>
<p>This is basically a numerical discretization issue. Whenever the base
state aligns with the grid, you should be able to show that you get
exactly the same answer each way.</p>
<p>When you do a spherical star on a 3d Cartesian grid, though, the <span class="math notranslate nohighlight">\(w_0\)</span>
is defined on the radial mesh and the <span class="math notranslate nohighlight">\(\tilde{\Ub}\)</span> on the Cartesian
mesh, and the <span class="math notranslate nohighlight">\(w_0\)</span> part never experiences the Cartesian projection,
for example. So there are differences in exactly how the <span class="math notranslate nohighlight">\(w_0\)</span> component
appears (projected on the Cartesian mesh vs. interpolated from the
radial mesh)—we made the decision at the time to separate the
components for that reason.</p>
</li>
<li><p><em>Why does “checkerboarding” appear in the velocity field,
especially in regions where the flow is stagnant?</em></p>
<p>Checkerboarding can arise from the projection—it doesn’t see that
mode (because it is an approximate projection) so it is unable to
remove it. This allows the pattern to slowly build up. There are
filtering techniques that can be used to remove these modes, but
they are not implemented in MAESTROeX.</p>
</li>
</ol>
</section>
<section id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p><em>I want to open a plotfile, derive a new quantity from
the data stored there, and write out a new plotfile with this derived
data. How do I do this?</em></p>
<p>One implementation of this can be found in
<code class="docutils literal notranslate"><span class="pre">amrex/Tools/Postprocessing/C_Src/PtwisePltTransform.cpp</span></code>. This reads in
the plotfile data using the the <code class="docutils literal notranslate"><span class="pre">AMReX_DataServices</span></code> class, performs a
transformation on the data based on a set of components specified in the
command line, and outputs the solution to a new plotfile.</p>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="managingjobs.html" class="btn btn-neutral float-left" title="Managing Jobs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lo_density.html" class="btn btn-neutral float-right" title="Low Density Cutoffs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, MAESTROeX development tem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  


</body>
</html>